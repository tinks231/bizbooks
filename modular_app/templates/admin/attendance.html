<!DOCTYPE html>
<html>
<head>
  <title>Admin Dashboard</title>
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <style>
    body { font-family: Arial; margin: 0; padding: 20px; background: #f5f5f5; }
    .header { display: flex; justify-content: space-between; align-items: center; margin-bottom: 30px; padding: 20px; background: white; border-radius: 10px; }
    .header h2 { margin: 0; }
    .nav { display: flex; gap: 20px; }
    .nav a { padding: 10px 20px; background: #4CAF50; color: white; text-decoration: none; border-radius: 5px; }
    .nav a:hover { background: #45a049; }
    .logout { background: #f44336 !important; }
    .logout:hover { background: #da190b !important; }
    .container { background: white; padding: 30px; border-radius: 10px; box-shadow: 0 2px 10px rgba(0,0,0,0.1); margin-bottom: 20px; }
    table { width: 100%; border-collapse: collapse; margin-top: 20px; }
    th { background: #4CAF50; color: white; padding: 15px; text-align: left; font-size: 0.9em; }
    td { padding: 12px; border-bottom: 1px solid #ddd; vertical-align: middle; }
    tr:hover { background-color: #f5f5f5; }
    .photo { width: 50px; height: 50px; object-fit: cover; border-radius: 5px; cursor: pointer; transition: transform 0.2s; }
    .photo:hover { transform: scale(3); z-index: 1000; }
    .time-in { color: #4CAF50; }
    .time-out { color: #f44336; }
    .duration { background: #e3f2fd; padding: 5px 10px; border-radius: 5px; font-weight: bold; color: #1976d2; }
    .working { background: #fff3cd; padding: 5px 10px; border-radius: 5px; color: #856404; }
    .distance { color: #666; font-size: 0.85em; }
  </style>
</head>
<body>
  <div class="header">
    <h2>ğŸ“Š Admin Dashboard</h2>
    <div class="nav">
      <a href="/admin/dashboard">ğŸ“Š Dashboard</a>
      <a href="/admin/employees">ğŸ‘¥ Manage Employees</a>
      <a href="/admin/sites">ğŸ¢ Sites</a>
      <a href="/admin/inventory">ğŸ“¦ Inventory</a>
      <a href="/admin/manual_entry" style="background: #ff9800;">âœï¸ Manual Entry</a>
      <a href="/admin/logout" class="logout">Logout</a>
    </div>
  </div>
  
  <div class="container">
    <h3>ğŸ“… Attendance Records (Grouped by Employee & Date)</h3>
    <div style="margin-bottom: 20px; display: flex; gap: 10px;">
      <a href="/admin/export" style="padding: 10px 20px; background: #2196F3; color: white; text-decoration: none; border-radius: 5px;">ğŸ“¥ Export to CSV</a>
      <form method="POST" action="/admin/clear_attendance" style="display: inline; margin: 0;" onsubmit="return confirm('âš ï¸ Delete ALL attendance records? This cannot be undone!');">
        <button type="submit" style="padding: 10px 20px; background: #f44336; color: white; border: none; border-radius: 5px; cursor: pointer; font-size: 1em;">ğŸ—‘ï¸ Clear All Attendance Data</button>
      </form>
    </div>
    <table>
      <thead>
        <tr>
          <th>Date</th>
          <th>Employee</th>
          <th>Check In</th>
          <th>Check Out</th>
          <th>Duration</th>
          <th>In Photo</th>
          <th>Out Photo</th>
          <th>Comment</th>
          <th>Actions</th>
        </tr>
      </thead>
      <tbody>
        {% for pair in attendance_pairs %}
        <tr>
          <td>{{ pair.date }}</td>
          <td><strong>{{ pair.employee_name }}</strong></td>
          <td>
            <span class="time-in">{{ pair.check_in_time }}</span>
            <div class="distance">{{ pair.check_in_distance }}</div>
          </td>
          <td>
            {% if pair.check_out_time %}
              <span class="time-out">{{ pair.check_out_time }}</span>
              <div class="distance">{{ pair.check_out_distance }}</div>
            {% else %}
              <span class="working">Still Working</span>
            {% endif %}
          </td>
          <td>
            {% if pair.duration %}
              <span class="duration">{{ pair.duration }}</span>
            {% else %}
              <span class="working">â€”</span>
            {% endif %}
          </td>
          <td>
                                {% if pair.check_in_photo and pair.check_in_photo != 'manual_entry.jpg' %}
                                    {% if pair.check_in_photo.startswith('http') %}
                                        <img src='{{ pair.check_in_photo }}' class='photo' title='Check In'>
                                    {% else %}
                                        <img src='/selfie/{{ pair.check_in_photo }}' class='photo' title='Check In'>
                                    {% endif %}
                                {% else %}
                                    â€”
                                {% endif %}
          </td>
          <td>
                                {% if pair.check_out_photo and pair.check_out_photo != 'manual_entry.jpg' %}
                                    {% if pair.check_out_photo.startswith('http') %}
                                        <img src='{{ pair.check_out_photo }}' class='photo' title='Check Out'>
                                    {% else %}
                                        <img src='/selfie/{{ pair.check_out_photo }}' class='photo' title='Check Out'>
                                    {% endif %}
                                {% else %}
                                    â€”
                                {% endif %}
          </td>
          <td style="max-width: 200px; font-size: 0.85em; color: #666;">
            {% if pair.check_in_comment or pair.check_out_comment %}
              <div style="background: #fff3cd; padding: 5px; border-radius: 3px;">
                {% if pair.check_in_comment %}
                  <div style="margin-bottom: 3px;">
                    <strong>In:</strong> {{ pair.check_in_comment }}
                    {% if pair.check_in_manual %}<span style="color: #ff9800; font-weight: bold;" title="Manual Entry">âœï¸</span>{% endif %}
                  </div>
                {% endif %}
                {% if pair.check_out_comment %}
                  <div>
                    <strong>Out:</strong> {{ pair.check_out_comment }}
                    {% if pair.check_out_manual %}<span style="color: #ff9800; font-weight: bold;" title="Manual Entry">âœï¸</span>{% endif %}
                  </div>
                {% endif %}
              </div>
            {% else %}
              â€”
            {% endif %}
          </td>
          <td>
            <div style="display: flex; gap: 5px;">
              {% if pair.check_in_id %}
              <a href="/admin/record/delete/{{ pair.check_in_id }}" onclick="return confirm('Delete check-in record?');" style="padding: 5px 10px; background: #f44336; color: white; text-decoration: none; border-radius: 3px; font-size: 0.85em;">ğŸ—‘ï¸ In</a>
              {% endif %}
              {% if pair.check_out_id %}
              <a href="/admin/record/delete/{{ pair.check_out_id }}" onclick="return confirm('Delete check-out record?');" style="padding: 5px 10px; background: #f44336; color: white; text-decoration: none; border-radius: 3px; font-size: 0.85em;">ğŸ—‘ï¸ Out</a>
              {% endif %}
            </div>
          </td>
        </tr>
        {% endfor %}
      </tbody>
    </table>
    
    {% if not attendance_pairs %}
    <p style="text-align: center; color: #999; padding: 40px 0;">No attendance records yet.</p>
    {% endif %}
  </div>
</body>
</html>
