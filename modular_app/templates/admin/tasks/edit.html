{% extends 'base_sidebar.html' %}

{% block title %}Edit Task - {{ tenant.company_name }}{% endblock %}

{% block page_title %}Edit Task #{{ task.task_number }}{% endblock %}

{% block header_actions %}
<a href="{{ url_for('tasks.view', task_id=task.id) }}" class="btn btn-secondary">
    ‚Üê Back to Task
</a>
{% endblock %}

{% block content %}

<form method="POST" action="{{ url_for('tasks.edit', task_id=task.id) }}">
    
    <!-- Task Details Card -->
    <div class="card">
        <div class="card-header">
            <h3 class="card-title">Task Details</h3>
        </div>
        
        <div class="form-row">
            <div class="form-group form-group--full">
                <label class="field-label field-label--required" for="title">Task Title</label>
                <input type="text" id="title" name="title" value="{{ task.title }}" required>
            </div>
        </div>
        
        <div class="form-row">
            <div class="form-group form-group--full">
                <label class="field-label" for="description">Description</label>
                <textarea id="description" name="description" rows="4">{{ task.description or '' }}</textarea>
            </div>
        </div>
        
        <div class="form-row">
            <div class="form-group">
                <label class="field-label field-label--required" for="priority">Priority</label>
                <select id="priority" name="priority" required>
                    <option value="low" {% if task.priority == 'low' %}selected{% endif %}>Low Priority</option>
                    <option value="medium" {% if task.priority == 'medium' %}selected{% endif %}>Medium Priority</option>
                    <option value="high" {% if task.priority == 'high' %}selected{% endif %}>üî• High Priority</option>
                </select>
            </div>
            
            <div class="form-group">
                <label class="field-label field-label--required" for="assigned_to">Assign To</label>
                <select id="assigned_to" name="assigned_to" required>
                    {% for employee in employees %}
                    <option value="{{ employee.id }}" {% if employee.id == task.assigned_to %}selected{% endif %}>
                        {{ employee.name }} - {{ employee.phone }}
                    </option>
                    {% endfor %}
                </select>
            </div>
        </div>
    </div>
    
    <!-- Location & Timeline Card -->
    <div class="card">
        <div class="card-header">
            <h3 class="card-title">Location & Timeline</h3>
        </div>
        
        <div class="form-row">
            <div class="form-group">
                <label class="field-label" for="site_id">Site/Location</label>
                <select id="site_id" name="site_id">
                    <option value="">No specific site</option>
                    {% for site in sites %}
                    <option value="{{ site.id }}" {% if task.site_id == site.id %}selected{% endif %}>
                        {{ site.name }}
                    </option>
                    {% endfor %}
                </select>
            </div>
            
            <div class="form-group">
                <label class="field-label" for="start_date">Start Date</label>
                <input type="date" id="start_date" name="start_date" 
                       value="{{ task.start_date.strftime('%Y-%m-%d') if task.start_date else '' }}">
            </div>
        </div>
        
        <div class="form-row">
            <div class="form-group">
                <label class="field-label" for="deadline">Deadline</label>
                <input type="date" id="deadline" name="deadline" 
                       value="{{ task.deadline.strftime('%Y-%m-%d') if task.deadline else '' }}">
            </div>
            <div class="form-group">
                <!-- Empty placeholder for alignment -->
            </div>
        </div>
    </div>
    
    <!-- Submit Button -->
    <div class="form-actions" style="margin-bottom: 30px;">
        <button type="submit" class="btn btn-primary" style="flex: 1;">
            üíæ Save Changes
        </button>
        <a href="{{ url_for('tasks.view', task_id=task.id) }}" class="btn btn-secondary" style="flex: 1;">
            Cancel
        </a>
    </div>
    
</form>

{% endblock %}
