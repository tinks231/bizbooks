<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Purchase Bill - {{ bill.bill_number }}</title>
    <style>
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }
        
        body {
            font-family: Arial, sans-serif;
            font-size: 10pt;
            line-height: 1.3;
            color: #000;
            padding: 10mm;
            background: white;
        }
        
        .invoice-container {
            max-width: 190mm;
            margin: 0 auto;
            border: 2px solid #000;
            padding: 8mm;
        }
        
        /* Compact Header */
        .invoice-header {
            border-bottom: 2px solid #000;
            padding-bottom: 5mm;
            margin-bottom: 3mm;
        }
        
        .company-name {
            font-size: 18pt;
            font-weight: bold;
            text-align: center;
            margin-bottom: 2mm;
        }
        
        .company-details {
            text-align: center;
            font-size: 9pt;
            line-height: 1.4;
        }
        
        .invoice-title {
            text-align: center;
            font-size: 14pt;
            font-weight: bold;
            background: #f0f0f0;
            padding: 3mm 0;
            border: 1px solid #000;
            margin: 3mm 0;
        }
        
        /* Compact Info Grid */
        .info-grid {
            display: grid;
            grid-template-columns: 1fr 1fr;
            gap: 3mm;
            margin-bottom: 3mm;
        }
        
        .info-box {
            border: 1px solid #000;
            padding: 2mm;
        }
        
        .info-box-title {
            font-weight: bold;
            font-size: 9pt;
            margin-bottom: 2mm;
            padding-bottom: 1mm;
            border-bottom: 1px solid #ccc;
        }
        
        .info-row {
            display: flex;
            justify-content: space-between;
            padding: 1mm 0;
            font-size: 9pt;
        }
        
        .info-label {
            font-weight: 600;
        }
        
        /* Compact Table */
        .items-table {
            width: 100%;
            border-collapse: collapse;
            margin-bottom: 3mm;
            font-size: 9pt;
        }
        
        .items-table th {
            background: #333;
            color: white;
            padding: 2mm;
            text-align: left;
            font-weight: bold;
            border: 1px solid #000;
        }
        
        .items-table td {
            padding: 2mm;
            border: 1px solid #000;
        }
        
        .items-table th.text-center,
        .items-table td.text-center {
            text-align: center;
        }
        
        .items-table th.text-right,
        .items-table td.text-right {
            text-align: right;
        }
        
        .items-table tbody tr:nth-child(even) {
            background: #f9f9f9;
        }
        
        .items-table .total-row {
            background: #e9ecef;
            font-weight: bold;
        }
        
        /* Compact Summary */
        .summary-grid {
            display: grid;
            grid-template-columns: 60% 40%;
            gap: 3mm;
            margin-bottom: 3mm;
        }
        
        .summary-box {
            border: 1px solid #000;
            padding: 2mm;
        }
        
        .gst-table {
            width: 100%;
            border-collapse: collapse;
            font-size: 9pt;
        }
        
        .gst-table th,
        .gst-table td {
            padding: 1.5mm;
            border: 1px solid #666;
            text-align: center;
        }
        
        .gst-table th {
            background: #f0f0f0;
            font-weight: bold;
        }
        
        .amount-summary {
            font-size: 9pt;
        }
        
        .amount-row {
            display: flex;
            justify-content: space-between;
            padding: 1.5mm 0;
            border-bottom: 1px dashed #ccc;
        }
        
        .amount-row.total {
            font-weight: bold;
            font-size: 10pt;
            border-bottom: 2px solid #000;
            padding-top: 2mm;
        }
        
        .amount-in-words {
            font-size: 8pt;
            padding: 2mm 0;
            font-style: italic;
        }
        
        /* Footer */
        .footer-grid {
            display: grid;
            grid-template-columns: 1fr 1fr;
            gap: 3mm;
            margin-bottom: 3mm;
        }
        
        .footer-box {
            border: 1px solid #000;
            padding: 2mm;
            font-size: 8pt;
        }
        
        .footer-box-title {
            font-weight: bold;
            margin-bottom: 2mm;
        }
        
        .signature-box {
            text-align: right;
            padding-top: 10mm;
        }
        
        .signature-line {
            border-top: 1px solid #000;
            margin-top: 2mm;
            padding-top: 1mm;
            font-weight: bold;
        }
        
        .footer-note {
            text-align: center;
            font-size: 8pt;
            color: #666;
            padding-top: 2mm;
        }
        
        /* Print Styles */
        @media print {
            body {
                padding: 0;
            }
            
            .invoice-container {
                border: none;
                max-width: 100%;
            }
            
            @page {
                margin: 10mm;
                size: A4 portrait;
            }
        }
    </style>
</head>
<body>
<div class="invoice-container">
    <!-- Header -->
    <div class="invoice-header">
        <div class="company-name">{{ tenant.company_name or 'Company Name' }}</div>
        <div class="company-details">
            {% if bill.vendor_address %}{{ bill.vendor_address }}<br>{% endif %}
            {% if bill.vendor_phone %}Phone: {{ bill.vendor_phone }} | {% endif %}
            {% if bill.vendor_gstin %}GSTIN: {{ bill.vendor_gstin }}{% endif %}
        </div>
    </div>
    
    <div class="invoice-title">PURCHASE BILL</div>
    
    <!-- Info Grid -->
    <div class="info-grid">
        <!-- Vendor Info -->
        <div class="info-box">
            <div class="info-box-title">Vendor Details:</div>
            <div class="info-row">
                <span class="info-label">Name:</span>
                <span>{{ bill.vendor_name }}</span>
            </div>
            {% if bill.vendor_phone %}
            <div class="info-row">
                <span class="info-label">Phone:</span>
                <span>{{ bill.vendor_phone }}</span>
            </div>
            {% endif %}
            {% if bill.vendor_gstin %}
            <div class="info-row">
                <span class="info-label">GSTIN:</span>
                <span>{{ bill.vendor_gstin }}</span>
            </div>
            {% endif %}
            {% if bill.vendor_state %}
            <div class="info-row">
                <span class="info-label">State:</span>
                <span>{{ bill.vendor_state }}</span>
            </div>
            {% endif %}
        </div>
        
        <!-- Bill Info -->
        <div class="info-box">
            <div class="info-box-title">Bill Details:</div>
            <div class="info-row">
                <span class="info-label">Bill No:</span>
                <span>{{ bill.bill_number }}</span>
            </div>
            <div class="info-row">
                <span class="info-label">Date:</span>
                <span>{{ bill.bill_date.strftime('%d-%b-%Y') }}</span>
            </div>
            {% if bill.due_date %}
            <div class="info-row">
                <span class="info-label">Due Date:</span>
                <span>{{ bill.due_date.strftime('%d-%b-%Y') }}</span>
            </div>
            {% endif %}
            {% if bill.reference_number %}
            <div class="info-row">
                <span class="info-label">Ref No:</span>
                <span>{{ bill.reference_number }}</span>
            </div>
            {% endif %}
        </div>
    </div>
    
    <!-- Items Table -->
    <table class="items-table">
        <thead>
            <tr>
                <th style="width: 5%;">#</th>
                <th style="width: 35%;">Item Description</th>
                <th class="text-center" style="width: 10%;">HSN/SAC</th>
                <th class="text-center" style="width: 10%;">Qty</th>
                <th class="text-right" style="width: 12%;">Rate</th>
                <th class="text-right" style="width: 10%;">Disc</th>
                <th class="text-right" style="width: 8%;">GST</th>
                <th class="text-right" style="width: 10%;">Amount</th>
            </tr>
        </thead>
        <tbody>
            {% for item in bill.items %}
            <tr>
                <td class="text-center">{{ loop.index }}</td>
                <td>{{ item.item_name }}</td>
                <td class="text-center">{{ item.hsn_code or '-' }}</td>
                <td class="text-center">{{ "%.2f"|format(item.quantity) }}</td>
                <td class="text-right">₹{{ "%.2f"|format(item.rate) }}</td>
                <td class="text-right">
                    {% if item.discount_amount > 0 %}
                    ₹{{ "%.2f"|format(item.discount_amount) }}
                    {% if item.discount_percent > 0 %}({{ "%.1f"|format(item.discount_percent) }}%){% endif %}
                    {% else %}
                    -
                    {% endif %}
                </td>
                <td class="text-right">{{ "%.1f"|format(item.gst_rate) }}%</td>
                <td class="text-right">₹{{ "%.2f"|format(item.total) }}</td>
            </tr>
            {% endfor %}
            <tr class="total-row">
                <td colspan="7" class="text-right">Subtotal</td>
                <td class="text-right">₹{{ "%.2f"|format(bill.subtotal_amount) }}</td>
            </tr>
        </tbody>
    </table>
    
    <!-- Summary Grid -->
    <div class="summary-grid">
        <!-- GST Breakdown -->
        <div class="summary-box">
            <div class="info-box-title">Tax Summary:</div>
            <table class="gst-table">
                <thead>
                    <tr>
                        <th>Tax</th>
                        <th>Rate</th>
                        <th>Amount</th>
                    </tr>
                </thead>
                <tbody>
                    {% if bill.cgst_amount > 0 %}
                    <tr>
                        <td>CGST</td>
                        <td>-</td>
                        <td>₹{{ "%.2f"|format(bill.cgst_amount) }}</td>
                    </tr>
                    {% endif %}
                    {% if bill.sgst_amount > 0 %}
                    <tr>
                        <td>SGST</td>
                        <td>-</td>
                        <td>₹{{ "%.2f"|format(bill.sgst_amount) }}</td>
                    </tr>
                    {% endif %}
                    {% if bill.igst_amount > 0 %}
                    <tr>
                        <td>IGST</td>
                        <td>-</td>
                        <td>₹{{ "%.2f"|format(bill.igst_amount) }}</td>
                    </tr>
                    {% endif %}
                    <tr>
                        <td colspan="2"><strong>Total Tax</strong></td>
                        <td><strong>₹{{ "%.2f"|format(bill.cgst_amount + bill.sgst_amount + bill.igst_amount) }}</strong></td>
                    </tr>
                </tbody>
            </table>
        </div>
        
        <!-- Amount Summary -->
        <div class="summary-box">
            <div class="amount-summary">
                <div class="amount-row">
                    <span>Subtotal:</span>
                    <span>₹{{ "%.2f"|format(bill.subtotal_amount) }}</span>
                </div>
                {% if bill.discount_amount > 0 %}
                <div class="amount-row">
                    <span>Discount:</span>
                    <span>-₹{{ "%.2f"|format(bill.discount_amount) }}</span>
                </div>
                {% endif %}
                <div class="amount-row">
                    <span>Total Tax:</span>
                    <span>₹{{ "%.2f"|format(bill.cgst_amount + bill.sgst_amount + bill.igst_amount) }}</span>
                </div>
                {% if bill.other_charges > 0 %}
                <div class="amount-row">
                    <span>Other Charges:</span>
                    <span>₹{{ "%.2f"|format(bill.other_charges) }}</span>
                </div>
                {% endif %}
                <div class="amount-row total">
                    <span>Total Amount:</span>
                    <span>₹{{ "%.2f"|format(bill.total_amount) }}</span>
                </div>
            </div>
        </div>
    </div>
    
    <!-- Footer Grid -->
    <div class="footer-grid">
        <!-- Notes/Terms -->
        <div class="footer-box">
            {% if bill.notes %}
            <div class="footer-box-title">Notes:</div>
            <div>{{ bill.notes }}</div>
            {% endif %}
            {% if bill.terms_conditions %}
            <div class="footer-box-title" style="margin-top: 2mm;">Terms & Conditions:</div>
            <div>{{ bill.terms_conditions }}</div>
            {% endif %}
        </div>
        
        <!-- Signature -->
        <div class="footer-box">
            <div class="signature-box">
                <div>For {{ tenant.company_name or 'Company Name' }}</div>
                <div class="signature-line">Authorized Signatory</div>
            </div>
        </div>
    </div>
    
    <div class="footer-note">
        This is a computer-generated document. No signature required.<br>
        Generated on {{ now.strftime('%d %b %Y at %I:%M %p') }}
    </div>
</div>

<script>
    // Auto-trigger print dialog
    window.onload = function() {
        // Optional: Uncomment to auto-print
        // window.print();
    };
</script>
</body>
</html>
