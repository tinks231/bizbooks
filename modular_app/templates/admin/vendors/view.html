{% extends 'base_sidebar.html' %}

{% block title %}{{ vendor.name }} - {{ tenant.company_name }}{% endblock %}

{% block page_title %}Vendor Details{% endblock %}

{% block header_actions %}
<a href="{{ url_for('vendors.index') }}" class="btn btn-secondary">
    ‚Üê Back to Vendors
</a>
<a href="{{ url_for('vendors.ledger', vendor_id=vendor.id) }}" class="btn btn-info">
    üìä View Ledger
</a>
<a href="{{ url_for('vendors.edit', vendor_id=vendor.id) }}" class="btn btn-primary">
    ‚úèÔ∏è Edit
</a>
{% endblock %}

{% block content %}

<!-- Vendor Info Card -->
<div class="card">
    <div class="card-header">
        <h3 class="card-title">{{ vendor.name }}</h3>
        {% if vendor.is_active %}
            <span class="badge badge-success">Active</span>
        {% else %}
            <span class="badge badge-secondary">Inactive</span>
        {% endif %}
    </div>
    
    <div style="display: grid; grid-template-columns: 1fr 1fr; gap: 30px;">
        <!-- Left Column -->
        <div>
            <h4 style="margin-bottom: 15px; color: #2c3e50;">Contact Information</h4>
            
            <div class="info-row">
                <span class="label">Vendor Code:</span>
                <span class="value"><strong>{{ vendor.vendor_code }}</strong></span>
            </div>
            
            <div class="info-row">
                <span class="label">Contact Person:</span>
                <span class="value">{{ vendor.name }}</span>
            </div>
            
            {% if vendor.company_name %}
            <div class="info-row">
                <span class="label">Company Name:</span>
                <span class="value">{{ vendor.company_name }}</span>
            </div>
            {% endif %}
            
            {% if vendor.phone %}
            <div class="info-row">
                <span class="label">Phone:</span>
                <span class="value">üìû {{ vendor.phone }}</span>
            </div>
            {% endif %}
            
            {% if vendor.email %}
            <div class="info-row">
                <span class="label">Email:</span>
                <span class="value">‚úâÔ∏è {{ vendor.email }}</span>
            </div>
            {% endif %}
            
            {% if vendor.address %}
            <div class="info-row">
                <span class="label">Address:</span>
                <span class="value">{{ vendor.address }}</span>
            </div>
            {% endif %}
            
            {% if vendor.gstin %}
            <div class="info-row">
                <span class="label">GSTIN:</span>
                <span class="value">{{ vendor.gstin }}</span>
            </div>
            {% endif %}
            
            <div class="info-row">
                <span class="label">State:</span>
                <span class="value">{{ vendor.state or 'Not specified' }}</span>
            </div>
        </div>
        
        <!-- Right Column -->
        <div>
            <h4 style="margin-bottom: 15px; color: #2c3e50;">Payment Terms</h4>
            
            <div class="info-row">
                <span class="label">Credit Limit:</span>
                <span class="value">
                    {% if vendor.credit_limit > 0 %}
                        ‚Çπ{{ "%.0f"|format(vendor.credit_limit) }}
                    {% else %}
                        No limit
                    {% endif %}
                </span>
            </div>
            
            <div class="info-row">
                <span class="label">Payment Terms:</span>
                <span class="value">{{ vendor.payment_terms_days }} days</span>
            </div>
            
            <div class="info-row">
                <span class="label">Opening Balance:</span>
                <span class="value">
                    {% if vendor.opening_balance > 0 %}
                        <span style="color: #e74c3c;">‚Çπ{{ "%.2f"|format(vendor.opening_balance) }}</span>
                    {% else %}
                        <span style="color: #27ae60;">‚Çπ0.00</span>
                    {% endif %}
                </span>
            </div>
            
            <div class="info-row">
                <span class="label">Total Purchases:</span>
                <span class="value"><strong>{{ vendor.get_total_purchases() }}</strong></span>
            </div>
            
            {% if vendor.notes %}
            <div style="margin-top: 20px;">
                <h4 style="margin-bottom: 10px; color: #2c3e50;">Notes</h4>
                <p style="color: #7f8c8d; line-height: 1.6;">{{ vendor.notes }}</p>
            </div>
            {% endif %}
        </div>
    </div>
</div>

<!-- Purchase Requests Card -->
<div class="card">
    <div class="card-header">
        <h3 class="card-title">Recent Purchase Requests</h3>
    </div>
    
    {% if purchase_requests %}
    <div style="overflow-x: auto;">
        <table class="table">
            <thead>
                <tr>
                    <th>Date</th>
                    <th>Item</th>
                    <th>Quantity</th>
                    <th>Purpose</th>
                    <th>Requested By</th>
                    <th>Status</th>
                </tr>
            </thead>
            <tbody>
                {% for pr in purchase_requests %}
                <tr>
                    <td>{{ pr.created_at.strftime('%d %b %Y') }}</td>
                    <td>{{ pr.item_name }}</td>
                    <td>{{ pr.quantity }} {{ pr.unit }}</td>
                    <td>{{ pr.purpose or '-' }}</td>
                    <td>{{ pr.employee_name }}</td>
                    <td>
                        {% if pr.status == 'pending' %}
                            <span class="badge badge-warning">Pending</span>
                        {% elif pr.status == 'approved' %}
                            <span class="badge badge-success">Approved</span>
                        {% elif pr.status == 'ordered' %}
                            <span class="badge badge-info">Ordered</span>
                        {% elif pr.status == 'delivered' %}
                            <span class="badge badge-success">Delivered</span>
                        {% elif pr.status == 'rejected' %}
                            <span class="badge badge-danger">Rejected</span>
                        {% else %}
                            <span class="badge badge-secondary">{{ pr.status }}</span>
                        {% endif %}
                    </td>
                </tr>
                {% endfor %}
            </tbody>
        </table>
    </div>
    {% else %}
    <div style="padding: 40px; text-align: center; color: #7f8c8d;">
        <p style="font-size: 48px; margin-bottom: 10px;">üì¶</p>
        <p style="font-size: 16px;">No purchase requests from this vendor yet</p>
    </div>
    {% endif %}
</div>

<!-- Delete Vendor (if no purchases) -->
{% if vendor.get_total_purchases() == 0 %}
<div class="card" style="border: 2px solid #e74c3c;">
    <div class="card-header">
        <h3 class="card-title" style="color: #e74c3c;">Danger Zone</h3>
    </div>
    
    <p style="margin-bottom: 15px; color: #7f8c8d;">
        This vendor has no purchase history and can be safely deleted.
    </p>
    
    <form method="POST" action="{{ url_for('vendors.delete', vendor_id=vendor.id) }}" 
          onsubmit="return confirm('Are you sure you want to delete this vendor? This action cannot be undone.');">
        <button type="submit" class="btn btn-danger">
            üóëÔ∏è Delete Vendor
        </button>
    </form>
</div>
{% endif %}

<style>
    .card {
        background: white;
        border-radius: 10px;
        padding: 25px;
        margin-bottom: 20px;
        box-shadow: 0 2px 4px rgba(0,0,0,0.1);
    }
    
    .card-header {
        display: flex;
        justify-content: space-between;
        align-items: center;
        margin-bottom: 20px;
        padding-bottom: 15px;
        border-bottom: 2px solid #f0f0f0;
    }
    
    .card-title {
        margin: 0;
        color: #2c3e50;
        font-size: 20px;
    }
    
    .info-row {
        display: grid;
        grid-template-columns: 180px 1fr;
        gap: 15px;
        padding: 10px 0;
        border-bottom: 1px solid #f0f0f0;
    }
    
    .info-row:last-child {
        border-bottom: none;
    }
    
    .label {
        color: #7f8c8d;
        font-weight: 600;
    }
    
    .value {
        color: #2c3e50;
    }
    
    .badge {
        display: inline-block;
        padding: 4px 12px;
        border-radius: 12px;
        font-size: 12px;
        font-weight: 600;
    }
    
    .badge-success {
        background: #d4edda;
        color: #155724;
    }
    
    .badge-secondary {
        background: #e2e3e5;
        color: #383d41;
    }
    
    .badge-warning {
        background: #fff3cd;
        color: #856404;
    }
    
    .badge-info {
        background: #d1ecf1;
        color: #0c5460;
    }
    
    .badge-danger {
        background: #f8d7da;
        color: #721c24;
    }
    
    .table {
        width: 100%;
        border-collapse: collapse;
    }
    
    .table th {
        background: #f8f9fa;
        padding: 12px;
        text-align: left;
        font-weight: 600;
        border-bottom: 2px solid #dee2e6;
    }
    
    .table td {
        padding: 12px;
        border-bottom: 1px solid #dee2e6;
    }
    
    .table tbody tr:hover {
        background: #f8f9fa;
    }
    
    @media (max-width: 768px) {
        .card > div[style*="grid-template-columns"] {
            grid-template-columns: 1fr !important;
        }
        
        .info-row {
            grid-template-columns: 1fr;
            gap: 5px;
        }
        
        .label {
            font-size: 12px;
        }
    }
</style>

{% endblock %}

