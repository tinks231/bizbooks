{% extends 'base_sidebar.html' %}

{% block title %}Invoice Settings - {{ tenant.company_name }}{% endblock %}

{% block page_title %}Invoice Settings{% endblock %}

{% block header_actions %}
<a href="{{ url_for('invoices.index') }}" class="btn btn-secondary">
    ‚Üê Back to Invoices
</a>
{% endblock %}

{% block content %}

<form method="POST" action="{{ url_for('invoices.settings') }}">
    
    <!-- Business Details Card -->
    <div class="card">
        <div class="card-header">
            <h3 class="card-title">Business Details</h3>
            <p style="margin: 5px 0 0 0; font-size: 14px; color: #666;">
                These details will appear on your invoices
            </p>
        </div>
        
        <div class="form-row">
            <div class="form-group">
                <label for="gstin">GSTIN (GST Number) *</label>
                <input type="text" id="gstin" name="gstin" class="form-control" 
                       value="{{ settings.get('gstin', '') }}" 
                       placeholder="27XXXXX1234X1Z5" 
                       maxlength="15" required>
                <small style="color: #666; margin-top: 5px;">15-digit GST identification number</small>
            </div>
            
            <div class="form-group">
                <label for="pan">PAN Card Number</label>
                <input type="text" id="pan" name="pan" class="form-control" 
                       value="{{ settings.get('pan', '') }}" 
                       placeholder="ABCDE1234F" 
                       maxlength="10" style="text-transform: uppercase;">
                <small style="color: #666; margin-top: 5px;">10-character PAN number (optional)</small>
            </div>
        </div>
        
        <div class="form-group">
            <label for="address">Business Address *</label>
            <textarea id="address" name="address" class="form-control" rows="2" required>{{ settings.get('address', '') }}</textarea>
            <small style="color: #666; margin-top: 5px;">Full address including building/shop number</small>
        </div>
        
        <div class="form-row">
            <div class="form-group">
                <label for="city">City *</label>
                <input type="text" id="city" name="city" class="form-control" 
                       value="{{ settings.get('city', '') }}" required>
            </div>
            
            <div class="form-group">
                <label for="state">State *</label>
                <select id="state" name="state" class="form-control" required>
                    <option value="">Select State</option>
                    {% set states = [
                        'Andhra Pradesh', 'Arunachal Pradesh', 'Assam', 'Bihar', 'Chhattisgarh',
                        'Goa', 'Gujarat', 'Haryana', 'Himachal Pradesh', 'Jharkhand',
                        'Karnataka', 'Kerala', 'Madhya Pradesh', 'Maharashtra', 'Manipur',
                        'Meghalaya', 'Mizoram', 'Nagaland', 'Odisha', 'Punjab',
                        'Rajasthan', 'Sikkim', 'Tamil Nadu', 'Telangana', 'Tripura',
                        'Uttar Pradesh', 'Uttarakhand', 'West Bengal', 'Delhi'
                    ] %}
                    {% for state_name in states %}
                    <option value="{{ state_name }}" {% if settings.get('state') == state_name %}selected{% endif %}>
                        {{ state_name }}
                    </option>
                    {% endfor %}
                </select>
                <small style="color: #666; margin-top: 5px;">Used for GST calculation (CGST+SGST vs IGST)</small>
            </div>
        </div>
        
        <div class="form-row">
            <div class="form-group">
                <label for="pincode">Pincode *</label>
                <input type="text" id="pincode" name="pincode" class="form-control" 
                       value="{{ settings.get('pincode', '') }}" 
                       placeholder="411001" 
                       maxlength="6" required>
            </div>
            
            <div class="form-group">
                <label for="website">Website</label>
                <input type="url" id="website" name="website" class="form-control" 
                       value="{{ settings.get('website', '') }}" 
                       placeholder="www.yourbusiness.com">
            </div>
        </div>
    </div>
    
    <!-- Invoice Customization Card -->
    <div class="card">
        <div class="card-header">
            <h3 class="card-title">Invoice Customization</h3>
            <p style="margin: 5px 0 0 0; font-size: 14px; color: #666;">
                Customize how your invoices look
            </p>
        </div>
        
        <div class="form-group">
            <label for="invoice_terms">Terms & Conditions</label>
            <textarea id="invoice_terms" name="invoice_terms" class="form-control" rows="3">{{ settings.get('invoice_terms', 'Payment due within 30 days.\nGoods once sold will not be taken back.\nSubject to Pune jurisdiction only.') }}</textarea>
            <small style="color: #666; margin-top: 5px;">Default terms that appear on all invoices (can be edited per invoice)</small>
        </div>
        
        <div class="form-group">
            <label for="invoice_footer">Invoice Footer Text</label>
            <input type="text" id="invoice_footer" name="invoice_footer" class="form-control" 
                   value="{{ settings.get('invoice_footer', 'Thank you for your business!') }}" 
                   placeholder="Thank you for your business!">
            <small style="color: #666; margin-top: 5px;">Appears at the bottom of invoices</small>
        </div>
    </div>
    
    <!-- Submit Button -->
    <div style="display: flex; gap: 15px; margin-bottom: 30px;">
        <button type="submit" class="btn btn-primary" style="flex: 1;">
            üíæ Save Settings
        </button>
        <a href="{{ url_for('invoices.index') }}" class="btn btn-secondary" style="flex: 1;">
            Cancel
        </a>
    </div>
    
</form>

<!-- Help Section -->
<div class="card" style="background: #f8f9fa; border-left: 4px solid #3498db;">
    <h4 style="margin-bottom: 15px; color: #2c3e50;">üí° Quick Tips</h4>
    
    <div style="margin-bottom: 15px;">
        <strong>GSTIN Format:</strong>
        <p style="margin: 5px 0; color: #666;">
            15 characters: 2 digits (state code) + 10 digits (PAN) + 1 digit (entity number) + Z + 1 check digit
            <br>Example: <code>27XXXXX1234X1Z5</code>
        </p>
    </div>
    
    <div style="margin-bottom: 15px;">
        <strong>State Selection:</strong>
        <p style="margin: 5px 0; color: #666;">
            Choose your business state correctly! This determines whether CGST+SGST or IGST is applied.
            <br>‚Ä¢ Same state transaction ‚Üí CGST (9%) + SGST (9%) = 18%
            <br>‚Ä¢ Inter-state transaction ‚Üí IGST (18%)
        </p>
    </div>
    
    <div>
        <strong>Need Help?</strong>
        <p style="margin: 5px 0; color: #666;">
            Contact your accountant or CA for GST registration assistance.
        </p>
    </div>
</div>

<style>
    .form-row {
        display: grid;
        grid-template-columns: 1fr 1fr;
        gap: 20px;
        margin-bottom: 20px;
    }
    
    .form-group {
        display: flex;
        flex-direction: column;
    }
    
    .form-group label {
        font-weight: 600;
        margin-bottom: 8px;
        color: #2c3e50;
    }
    
    .form-control {
        padding: 10px;
        border: 1px solid #ddd;
        border-radius: 5px;
        font-size: 14px;
    }
    
    .form-control:focus {
        outline: none;
        border-color: #3498db;
    }
    
    small {
        font-size: 12px;
        display: block;
    }
    
    code {
        background: #e8f4fd;
        padding: 2px 6px;
        border-radius: 3px;
        font-family: 'Courier New', monospace;
        color: #2c3e50;
    }
    
    @media (max-width: 768px) {
        .form-row {
            grid-template-columns: 1fr;
        }
    }
</style>

{% endblock %}

