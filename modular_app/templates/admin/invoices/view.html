{% extends 'base_sidebar.html' %}

{% block title %}Invoice #{{ invoice.invoice_number }} - {{ tenant.company_name }}{% endblock %}

{% block page_title %}{% endblock %}

{% block header_actions %}
<div style="display: flex; gap: 10px; flex-wrap: wrap;">
    <button onclick="window.print()" class="btn btn-primary">
        üñ®Ô∏è Print Invoice
    </button>
    
    {% if invoice.status == 'draft' %}
    <a href="{{ url_for('invoices.mark_sent', invoice_id=invoice.id) }}" class="btn btn-success" 
       onclick="return confirm('Mark this invoice as sent?')">
        ‚úâÔ∏è Mark as Sent
    </a>
    <a href="{{ url_for('invoices.edit', invoice_id=invoice.id) }}" class="btn btn-secondary">
        ‚úèÔ∏è Edit
    </a>
    {% elif invoice.payment_status == 'unpaid' %}
    <a href="{{ url_for('invoices.record_payment', invoice_id=invoice.id) }}" class="btn btn-success">
        üí∞ Record Payment
    </a>
    {% endif %}
    
    <a href="{{ url_for('invoices.index') }}" class="btn btn-secondary">
        ‚Üê Back to Invoices
    </a>
</div>
{% endblock %}

{% block content %}

<!-- Theme Selector (only show on screen, not in print) -->
<div class="theme-selector no-print">
    <label style="font-weight: 600; margin-right: 10px;">Invoice Theme:</label>
    <select id="themeSelect" onchange="changeTheme(this.value)" style="padding: 8px; border-radius: 5px; border: 1px solid #ddd;">
        <option value="purple">Purple Professional</option>
        <option value="blue">Blue Corporate</option>
        <option value="green">Green Fresh</option>
        <option value="orange">Orange Vibrant</option>
        <option value="teal">Teal Modern</option>
        <option value="black">Black Formal</option>
    </select>
</div>

<!-- Invoice Container -->
<div class="invoice-container" id="invoicePrintArea">
    
    <!-- Invoice Header -->
    <div class="invoice-header">
        <div class="company-details">
            <h1 class="company-name">{{ tenant.company_name }}</h1>
            {% if tenant_settings %}
                {% if tenant_settings.get('address') %}
                <p class="company-info">üìç {{ tenant_settings.get('address') }}</p>
                {% endif %}
                <p class="company-info">üìû {{ tenant_settings.get('phone', tenant.admin_phone) }}</p>
                <p class="company-info">‚úâÔ∏è {{ tenant_settings.get('email', tenant.admin_email) }}</p>
                {% if tenant_settings.get('gstin') %}
                <p class="company-info"><strong>GSTIN:</strong> {{ tenant_settings.get('gstin') }}</p>
                {% endif %}
            {% else %}
                <p class="company-info">üìû {{ tenant.admin_phone }}</p>
                <p class="company-info">‚úâÔ∏è {{ tenant.admin_email }}</p>
            {% endif %}
        </div>
        
        {% if tenant_settings and tenant_settings.get('logo_url') %}
        <div class="logo-placeholder">
            <img src="{{ tenant_settings.get('logo_url') }}" alt="Company Logo" style="max-width: 100%; max-height: 100%; object-fit: contain;">
        </div>
        {% endif %}
    </div>
    
    <!-- Tax Invoice Title -->
    <div class="invoice-title">
        <h2>TAX INVOICE</h2>
    </div>
    
    <!-- Invoice Info Row -->
    <div class="invoice-info-row">
        <div class="bill-to">
            <h3>Bill To</h3>
            <p class="customer-name">{{ invoice.customer_name }}</p>
            {% if invoice.customer_id and invoice.customer %}
            <p style="color: #666; font-size: 13px; margin-top: 3px;">
                <strong>Customer ID:</strong> {{ invoice.customer.customer_code }}
                {% if invoice.customer.phone %}
                | üìû {{ invoice.customer.phone }}
                {% endif %}
            </p>
            {% elif invoice.customer_phone %}
            <p>üìû {{ invoice.customer_phone }}</p>
            {% endif %}
            {% if invoice.customer_email %}
            <p>‚úâÔ∏è {{ invoice.customer_email }}</p>
            {% endif %}
            {% if invoice.customer_address %}
            <p>{{ invoice.customer_address }}</p>
            {% endif %}
            {% if invoice.customer_gstin %}
            <p><strong>GSTIN:</strong> {{ invoice.customer_gstin }}</p>
            {% endif %}
            <p><strong>State:</strong> {{ invoice.customer_state }}</p>
        </div>
        
        <div class="invoice-details">
            <h3>Invoice Details</h3>
            <table class="details-table">
                <tr>
                    <td><strong>Invoice No:</strong></td>
                    <td>{{ invoice.invoice_number }}</td>
                </tr>
                <tr>
                    <td><strong>Date:</strong></td>
                    <td>{{ invoice.invoice_date.strftime('%d-%m-%Y') }}</td>
                </tr>
                {% if invoice.due_date %}
                <tr>
                    <td><strong>Due Date:</strong></td>
                    <td>{{ invoice.due_date.strftime('%d-%m-%Y') }}</td>
                </tr>
                {% endif %}
                <tr>
                    <td><strong>Status:</strong></td>
                    <td>
                        <span class="status-badge status-{{ invoice.status }}">
                            {{ invoice.status.upper() }}
                        </span>
                    </td>
                </tr>
                <tr>
                    <td><strong>Payment:</strong></td>
                    <td>
                        <span class="status-badge status-{{ invoice.payment_status }}">
                            {{ invoice.payment_status.upper() }}
                        </span>
                    </td>
                </tr>
            </table>
        </div>
    </div>
    
    <!-- Items Table -->
    <div class="items-section">
        <table class="items-table">
            <thead>
                <tr class="table-header">
                    <th style="width: 30px;">#</th>
                    <th style="text-align: left;">Item Name</th>
                    <th style="width: 120px;">SKU</th>
                    <th style="width: 100px;">HSN/SAC</th>
                    <th style="width: 60px;">Quantity</th>
                    <th style="width: 60px;">Unit</th>
                    <th style="width: 100px; text-align: right;">Rate (‚Çπ)</th>
                    <th style="width: 80px; text-align: center;">GST %</th>
                    <th style="width: 120px; text-align: right;">Amount (‚Çπ)</th>
                </tr>
            </thead>
            <tbody>
                {% for item in invoice.items %}
                <tr>
                    <td>{{ loop.index }}</td>
                    <td>
                        <strong>{{ item.item_name }}</strong>
                        {% if item.description %}
                        <br><small style="color: #666;">{{ item.description }}</small>
                        {% endif %}
                    </td>
                    <td>
                        {% if item.item and item.item.sku %}
                            <small style="color: #666;">{{ item.item.sku }}</small>
                        {% else %}
                            -
                        {% endif %}
                    </td>
                    <td>{{ item.hsn_code or '-' }}</td>
                    <td>{{ item.quantity }}</td>
                    <td>{{ item.unit }}</td>
                    <td style="text-align: right;">{{ "%.2f"|format(item.rate) }}</td>
                    <td style="text-align: center;">{{ item.gst_rate }}%</td>
                    <td style="text-align: right;">
                        <strong>{{ "%.2f"|format(item.taxable_value + item.cgst_amount + item.sgst_amount + item.igst_amount) }}</strong>
                    </td>
                </tr>
                {% endfor %}
            </tbody>
        </table>
    </div>
    
    <!-- Totals Section -->
    <div class="totals-section">
        <div class="invoice-notes">
            <h4>Amount in Words:</h4>
            <p><em>{{ invoice.amount_in_words() }}</em></p>
            
            {% if invoice.notes %}
            <h4 style="margin-top: 20px;">Terms & Conditions:</h4>
            <p style="white-space: pre-line;">{{ invoice.notes }}</p>
            {% endif %}
        </div>
        
        <div class="totals-table">
            <table>
                <tr>
                    <td><strong>Subtotal:</strong></td>
                    <td style="text-align: right;">‚Çπ{{ "%.2f"|format(invoice.subtotal) }}</td>
                </tr>
                
                {% if invoice.discount_amount and invoice.discount_amount > 0 %}
                <tr>
                    <td><strong>Discount:</strong></td>
                    <td style="text-align: right; color: #e74c3c;">-‚Çπ{{ "%.2f"|format(invoice.discount_amount) }}</td>
                </tr>
                {% endif %}
                
                {% if invoice.cgst_amount > 0 %}
                <tr>
                    <td>CGST:</td>
                    <td style="text-align: right;">‚Çπ{{ "%.2f"|format(invoice.cgst_amount) }}</td>
                </tr>
                <tr>
                    <td>SGST:</td>
                    <td style="text-align: right;">‚Çπ{{ "%.2f"|format(invoice.sgst_amount) }}</td>
                </tr>
                {% endif %}
                
                {% if invoice.igst_amount > 0 %}
                <tr>
                    <td>IGST:</td>
                    <td style="text-align: right;">‚Çπ{{ "%.2f"|format(invoice.igst_amount) }}</td>
                </tr>
                {% endif %}
                
                {% if invoice.round_off and invoice.round_off != 0 %}
                <tr>
                    <td>Round Off:</td>
                    <td style="text-align: right;">‚Çπ{{ "%.2f"|format(invoice.round_off) }}</td>
                </tr>
                {% endif %}
                
                <tr class="total-row">
                    <td><strong>TOTAL:</strong></td>
                    <td style="text-align: right;"><strong>‚Çπ{{ "%.2f"|format(invoice.total_amount) }}</strong></td>
                </tr>
            </table>
        </div>
    </div>
    
    <!-- Signature Section -->
    <div class="signature-section">
        <div class="customer-signature">
            <p>Customer Signature</p>
            <div class="signature-line"></div>
        </div>
        
        <div class="company-signature">
            <p>For: <strong>{{ tenant.company_name }}</strong></p>
            <div class="signature-line"></div>
            <p><strong>Authorized Signatory</strong></p>
        </div>
    </div>
    
    <!-- Footer -->
    <div class="invoice-footer">
        <p>Thank you for your business!</p>
        <p style="font-size: 12px; color: #666;">This is a computer-generated invoice and does not require a signature.</p>
    </div>
    
</div>

<style>
    /* Hide navigation and buttons when printing */
    @media print {
        /* AGGRESSIVE: Hide EVERYTHING except invoice */
        * {
            visibility: hidden !important;
        }
        
        /* SHOW: Only invoice and its children */
        .invoice-container,
        .invoice-container * {
            visibility: visible !important;
        }
        
        /* Hide UI elements */
        .sidebar, 
        .no-print,
        .btn,
        .theme-selector,
        .header,
        .header-title,
        .header-actions,
        nav,
        .page-header,
        .breadcrumb {
            display: none !important;
            visibility: hidden !important;
        }
        
        body {
            background: white !important;
            margin: 0 !important;
            padding: 0 !important;
        }
        
        /* Make content take full width */
        .content {
            margin: 0 !important;
            padding: 0 !important;
            width: 100% !important;
        }
        
        /* Invoice container positioning */
        .invoice-container {
            position: absolute !important;
            top: 0 !important;
            left: 0 !important;
            box-shadow: none !important;
            margin: 0 !important;
            padding: 8mm 10mm !important;
            max-width: 100% !important;
            width: 100% !important;
            page-break-inside: avoid !important;
            page-break-after: avoid !important;
            page-break-before: avoid !important;
            font-size: 10px;
        }
        
        /* Ensure all major sections stay together */
        .invoice-header,
        .invoice-title,
        .invoice-info-row,
        .items-section,
        .totals-section,
        .signature-section,
        .invoice-footer {
            page-break-inside: avoid !important;
        }
        
        .page-header {
            display: none;
        }
        
        /* Compress spacing for single page */
        .invoice-header {
            padding-bottom: 5px;
            margin-bottom: 8px;
            border-bottom: 2px solid var(--theme-color, #3b82f6);
        }
        
        .company-name {
            font-size: 16px;
            margin-bottom: 3px;
        }
        
        .company-info {
            font-size: 10px;
            margin: 2px 0;
        }
        
        .logo-placeholder {
            width: 80px;
            height: 80px;
        }
        
        .invoice-title {
            margin: 8px 0;
        }
        
        .invoice-title h2 {
            font-size: 16px;
            letter-spacing: 1px;
        }
        
        .invoice-info-row {
            margin-bottom: 8px;
        }
        
        .bill-to h3,
        .invoice-details h3 {
            padding: 3px 6px;
            margin-bottom: 4px;
            font-size: 11px;
        }
        
        .bill-to p {
            font-size: 9px;
            margin: 2px 0;
        }
        
        .invoice-details p,
        .details-table td {
            font-size: 9px;
            margin: 2px 0;
            padding: 2px 4px;
        }
        
        .customer-name {
            font-size: 12px;
        }
        
        .items-table th {
            padding: 4px 6px;
            font-size: 10px;
        }
        
        .items-table td {
            padding: 4px 6px;
            font-size: 10px;
        }
        
        .totals-section {
            margin: 10px 0;
            display: grid !important;
            grid-template-columns: 1fr 1fr !important;
            gap: 15px !important;
        }
        
        .invoice-info-row {
            display: grid !important;
            grid-template-columns: 1fr 1fr !important;
            gap: 15px !important;
        }
        
        .invoice-notes h4 {
            font-size: 11px;
            margin-bottom: 5px;
        }
        
        .invoice-notes p {
            font-size: 9px;
            line-height: 1.4;
        }
        
        .totals-table td {
            padding: 4px 8px;
            font-size: 10px;
        }
        
        .totals-table .total-row td {
            padding: 6px 10px;
            font-size: 13px;
        }
        
        .signature-section {
            margin: 12px 0 8px;
            padding-top: 10px;
        }
        
        .signature-section p {
            margin-bottom: 18px;
            font-size: 10px;
        }
        
        .invoice-footer {
            padding-top: 8px;
            margin-top: 10px;
        }
        
        .invoice-footer p {
            margin: 3px 0;
            font-size: 9px;
        }
        
        /* Ensure tables don't break */
        table {
            page-break-inside: avoid;
        }
        
        /* Fit everything on one page */
        @page {
            size: A4 portrait;
            margin: 5mm;
        }
        
        /* Prevent orphaned sections */
        * {
            orphans: 3;
            widows: 3;
        }
    }
    
    /* Theme Selector */
    .theme-selector {
        background: white;
        padding: 15px;
        border-radius: 8px;
        margin-bottom: 20px;
        box-shadow: 0 2px 4px rgba(0,0,0,0.1);
    }
    
    /* Invoice Container */
    .invoice-container {
        background: white;
        max-width: 1200px; /* Wider than A4 for screen */
        margin: 0 auto 30px;
        padding: 30px;
        box-shadow: 0 2px 10px rgba(0,0,0,0.1);
        border-radius: 8px;
    }
    
    /* Invoice Header */
    .invoice-header {
        display: flex;
        justify-content: space-between;
        align-items: flex-start;
        padding-bottom: 15px;
        border-bottom: 2px solid var(--theme-color, #8b5cf6);
        margin-bottom: 15px;
    }
    
    .company-details {
        flex: 1;
    }
    
    .company-name {
        font-size: 22px;
        font-weight: 700;
        color: var(--theme-color, #8b5cf6);
        margin: 0 0 8px 0;
    }
    
    .company-info {
        margin: 4px 0;
        color: #666;
        font-size: 13px;
    }
    
    .logo-placeholder {
        width: 120px;
        height: 120px;
    }
    
    .logo-box {
        width: 100%;
        height: 100%;
        border: 2px dashed var(--theme-color, #8b5cf6);
        border-radius: 8px;
        display: flex;
        align-items: center;
        justify-content: center;
        color: var(--theme-color, #8b5cf6);
        font-weight: 600;
        background: var(--theme-light, #f3f0ff);
    }
    
    /* Invoice Title */
    .invoice-title {
        text-align: center;
        margin: 20px 0 15px;
    }
    
    .invoice-title h2 {
        color: var(--theme-color, #8b5cf6);
        font-size: 20px;
        font-weight: 700;
        margin: 0;
        letter-spacing: 1.5px;
    }
    
    /* Invoice Info Row */
    .invoice-info-row {
        display: grid;
        grid-template-columns: 1fr 1fr;
        gap: 20px;
        margin-bottom: 20px;
    }
    
    .bill-to h3,
    .invoice-details h3 {
        background: var(--theme-color, #8b5cf6);
        color: white;
        padding: 6px 10px;
        margin: 0 0 8px 0;
        border-radius: 4px;
        font-size: 13px;
    }
    
    .bill-to p,
    .invoice-details p {
        margin: 5px 0;
        color: #333;
        font-size: 13px;
    }
    
    .customer-name {
        font-size: 16px;
        font-weight: 700;
        color: #2c3e50;
    }
    
    .details-table {
        width: 100%;
        border-collapse: collapse;
    }
    
    .details-table td {
        padding: 5px 8px;
        border-bottom: 1px solid #f0f0f0;
        font-size: 13px;
    }
    
    .details-table td:first-child {
        color: #666;
        font-weight: 500;
    }
    
    .details-table td:last-child {
        text-align: right;
        font-weight: 600;
    }
    
    /* Status Badges */
    .status-badge {
        display: inline-block;
        padding: 4px 12px;
        border-radius: 20px;
        font-size: 11px;
        font-weight: 700;
        text-transform: uppercase;
        letter-spacing: 0.5px;
    }
    
    .status-draft {
        background: #fef3c7;
        color: #92400e;
    }
    
    .status-sent {
        background: #dbeafe;
        color: #1e40af;
    }
    
    .status-paid {
        background: #d1fae5;
        color: #065f46;
    }
    
    .status-unpaid {
        background: #fee2e2;
        color: #991b1b;
    }
    
    .status-partial {
        background: #fed7aa;
        color: #9a3412;
    }
    
    /* Items Table */
    .items-section {
        margin: 20px 0;
    }
    
    .items-table {
        width: 100%;
        border-collapse: collapse;
        border: 1px solid #e0e0e0;
    }
    
    .items-table thead .table-header {
        background: var(--theme-color, #8b5cf6);
        color: white;
    }
    
    .items-table th {
        padding: 10px 12px;
        font-weight: 600;
        font-size: 14px;
        text-align: left;
    }
    
    .items-table td {
        padding: 10px 12px;
        border-bottom: 1px solid #f0f0f0;
        color: #333;
        font-size: 14px;
    }
    
    .items-table tbody tr:hover {
        background: #f8f9fa;
    }
    
    /* Totals Section */
    .totals-section {
        display: grid;
        grid-template-columns: 1.5fr 1fr;
        gap: 20px;
        margin: 20px 0;
    }
    
    .invoice-notes h4 {
        color: var(--theme-color, #8b5cf6);
        margin: 0 0 10px 0;
        font-size: 14px;
        font-weight: 700;
    }
    
    .invoice-notes p {
        margin: 0;
        color: #666;
        font-size: 14px;
        line-height: 1.6;
    }
    
    .totals-table table {
        width: 100%;
        border-collapse: collapse;
    }
    
    .totals-table td {
        padding: 10px 15px;
        border-bottom: 1px solid #f0f0f0;
        color: #333;
    }
    
    .totals-table .total-row {
        background: var(--theme-light, #f3f0ff);
        border-top: 2px solid var(--theme-color, #8b5cf6);
    }
    
    .totals-table .total-row td {
        font-size: 18px;
        padding: 15px;
        color: var(--theme-color, #8b5cf6);
    }
    
    /* Signature Section */
    .signature-section {
        display: grid;
        grid-template-columns: 1fr 1fr;
        gap: 30px;
        margin: 30px 0 20px;
        padding-top: 20px;
        border-top: 1px solid #e0e0e0;
    }
    
    .signature-section p {
        margin: 0 0 30px 0;
        color: #666;
        font-size: 13px;
    }
    
    .signature-line {
        border-bottom: 2px solid #333;
        margin-bottom: 10px;
    }
    
    .company-signature {
        text-align: right;
    }
    
    /* Footer */
    .invoice-footer {
        text-align: center;
        padding-top: 15px;
        border-top: 1px solid #e0e0e0;
        margin-top: 20px;
    }
    
    .invoice-footer p {
        margin: 4px 0;
        color: #666;
        font-size: 12px;
    }
    
    /* Mobile Responsive */
    @media (max-width: 768px) {
        .invoice-container {
            padding: 15px;
            margin: 0;
            border-radius: 0;
        }
        
        .invoice-header {
            flex-direction: row !important;
            justify-content: space-between;
            align-items: flex-start;
            gap: 10px;
        }
        
        .company-details {
            flex: 1;
            min-width: 0;
        }
        
        .company-name {
            font-size: 18px !important;
            margin-bottom: 5px;
        }
        
        .company-info {
            font-size: 11px !important;
            margin: 2px 0 !important;
        }
        
        .logo-placeholder {
            width: 80px !important;
            height: 80px !important;
            flex-shrink: 0;
        }
        
        .invoice-title h2 {
            font-size: 18px !important;
            margin: 15px 0 10px !important;
        }
        
        .invoice-info-row {
            grid-template-columns: 1fr 1fr !important;
            gap: 10px !important;
        }
        
        .bill-to,
        .invoice-details {
            min-width: 0;
        }
        
        .bill-to h3,
        .invoice-details h3 {
            font-size: 12px !important;
            padding: 5px 8px !important;
            margin-bottom: 8px !important;
        }
        
        .customer-name {
            font-size: 14px !important;
        }
        
        .bill-to p,
        .invoice-details p,
        .details-table td {
            font-size: 11px !important;
            margin: 3px 0 !important;
        }
        
        .totals-section {
            display: flex !important;
            flex-direction: column !important;
            gap: 15px !important;
        }
        
        /* Reorder: Totals first, then Amount in Words on mobile screen */
        .totals-section .totals-table {
            order: 1 !important; /* Show first */
            margin-left: auto !important; /* Align to right */
            max-width: 350px !important; /* Limit width for better right alignment */
        }
        
        .totals-section .invoice-notes {
            order: 2 !important; /* Show second */
        }
        
        .signature-section {
            grid-template-columns: 1fr !important;
        }
        
        .items-table {
            font-size: 11px !important;
        }
        
        .items-table th,
        .items-table td {
            padding: 6px 4px !important;
        }
        
        /* Make table scrollable on mobile if needed */
        .items-section {
            overflow-x: auto;
            -webkit-overflow-scrolling: touch;
        }
        
        .company-signature {
            text-align: left;
        }
    }
    
    /* Extra small mobile (portrait phones) */
    @media (max-width: 480px) {
        .invoice-info-row {
            grid-template-columns: 1fr !important;
            gap: 15px !important;
        }
        
        .company-name {
            font-size: 16px !important;
        }
        
        .company-info {
            font-size: 10px !important;
        }
        
        .logo-placeholder {
            width: 60px !important;
            height: 60px !important;
        }
        
        .items-table {
            font-size: 10px !important;
        }
        
        .items-table th,
        .items-table td {
            padding: 4px 3px !important;
        }
    }
    
    /* ========================================
       MOBILE PRINT FIX
       When printing from mobile, force 2-column layout
       This overrides the mobile screen CSS above
       ======================================== */
    @media print and (max-width: 768px) {
        /* Force two-column layout for Bill To and Invoice Details when printing from mobile */
        .invoice-info-row {
            display: grid !important;
            grid-template-columns: 1fr 1fr !important;
            gap: 10px !important;
        }
        
        /* Force two-column layout for Amount in Words and Totals when printing from mobile */
        .totals-section {
            display: grid !important;
            grid-template-columns: 1fr 1fr !important;
            gap: 15px !important;
        }
        
        /* Ensure notes stay on left, totals on right */
        .totals-section .invoice-notes {
            grid-column: 1 !important;
            order: 1 !important;
        }
        
        .totals-section .totals-table {
            grid-column: 2 !important;
            order: 2 !important;
        }
        
        /* Keep logo on right side */
        .invoice-header {
            display: flex !important;
            flex-direction: row !important;
            justify-content: space-between !important;
        }
        
        /* Reduce font sizes for mobile print to fit everything */
        .company-name {
            font-size: 14px !important;
        }
        
        .company-info {
            font-size: 9px !important;
        }
        
        .invoice-title h2 {
            font-size: 14px !important;
        }
        
        .bill-to h3,
        .invoice-details h3 {
            font-size: 10px !important;
            padding: 3px 5px !important;
        }
        
        .bill-to p,
        .invoice-details p,
        .details-table td {
            font-size: 8px !important;
        }
        
        .customer-name {
            font-size: 10px !important;
        }
        
        .items-table th,
        .items-table td {
            font-size: 9px !important;
            padding: 3px 4px !important;
        }
        
        .invoice-notes h4 {
            font-size: 10px !important;
        }
        
        .invoice-notes p {
            font-size: 8px !important;
        }
        
        .totals-table td {
            font-size: 9px !important;
            padding: 3px 6px !important;
        }
        
        .totals-table .total-row td {
            font-size: 11px !important;
            padding: 5px 8px !important;
        }
        
        .logo-placeholder {
            width: 60px !important;
            height: 60px !important;
        }
        
        /* Compress spacing */
        .invoice-container {
            padding: 5mm !important;
        }
        
        .invoice-header {
            margin-bottom: 5px !important;
        }
        
        .invoice-title {
            margin: 5px 0 !important;
        }
        
        .invoice-info-row {
            margin-bottom: 5px !important;
        }
        
        .items-section {
            margin: 8px 0 !important;
        }
        
        .totals-section {
            margin: 8px 0 !important;
        }
        
        .signature-section {
            margin: 8px 0 !important;
            padding-top: 8px !important;
        }
        
        .signature-section p {
            margin-bottom: 15px !important;
        }
    }
    
    /* Extra small mobile print (portrait phones) */
    @media print and (max-width: 480px) {
        /* Keep two columns but make everything even smaller */
        .invoice-info-row,
        .totals-section {
            grid-template-columns: 1fr 1fr !important;
        }
        
        .company-name {
            font-size: 12px !important;
        }
        
        .invoice-title h2 {
            font-size: 12px !important;
        }
        
        .items-table th,
        .items-table td {
            font-size: 8px !important;
            padding: 2px 3px !important;
        }
    }
</style>

<script>
    // Theme colors
    const themes = {
        purple: { color: '#8b5cf6', light: '#f3f0ff' },
        blue: { color: '#3b82f6', light: '#dbeafe' },
        green: { color: '#10b981', light: '#d1fae5' },
        orange: { color: '#f97316', light: '#ffedd5' },
        teal: { color: '#14b8a6', light: '#ccfbf1' },
        black: { color: '#1f2937', light: '#f3f4f6' }
    };
    
    function changeTheme(themeName) {
        const theme = themes[themeName];
        document.documentElement.style.setProperty('--theme-color', theme.color);
        document.documentElement.style.setProperty('--theme-light', theme.light);
        
        // Save preference
        localStorage.setItem('invoiceTheme', themeName);
    }
    
    // Load saved theme
    window.addEventListener('DOMContentLoaded', function() {
        const savedTheme = localStorage.getItem('invoiceTheme') || 'purple';
        document.getElementById('themeSelect').value = savedTheme;
        changeTheme(savedTheme);
    });
</script>

{% endblock %}

