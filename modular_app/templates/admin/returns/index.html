{% extends 'base_sidebar.html' %}

{% block title %}Returns & Refunds - {{ tenant.name }}{% endblock %}

{% block page_title %}Returns & Refunds{% endblock %}

{% block header_actions %}
<a href="{{ url_for('returns.create') }}" class="btn btn-primary">
    + New Return
</a>
{% endblock %}

{% block content %}

<!-- Stats Cards -->
<div class="stats-grid">
    <div class="stat-card">
        <div class="stat-icon" style="background: #e74c3c;">â†©ï¸</div>
        <div class="stat-content">
            <div class="stat-value">{{ total_returns }}</div>
            <div class="stat-label">Total Returns</div>
        </div>
    </div>
    
    <div class="stat-card">
        <div class="stat-icon" style="background: #f39c12;">ğŸ’¸</div>
        <div class="stat-content">
            <div class="stat-value">â‚¹{{ "%.2f"|format(total_refunded) }}</div>
            <div class="stat-label">Total Refunded</div>
        </div>
    </div>
    
    <div class="stat-card">
        <div class="stat-icon" style="background: #9b59b6;">ğŸ“Š</div>
        <div class="stat-content">
            <div class="stat-value">{{ "%.2f"|format(return_rate) }}%</div>
            <div class="stat-label">Return Rate</div>
        </div>
    </div>
</div>

<!-- Filters -->
<div class="card">
    <form method="GET" action="{{ url_for('returns.index') }}" style="display: flex; gap: 15px; flex-wrap: wrap; align-items: flex-end;">
        <div class="form-group" style="flex: 1; min-width: 200px; margin-bottom: 0;">
            <label for="search">Search</label>
            <input type="text" id="search" name="search" class="form-control" 
                   placeholder="Return #, Invoice #, Customer..." value="{{ search_query }}">
        </div>
        
        <div class="form-group" style="min-width: 150px; margin-bottom: 0;">
            <label for="status">Status</label>
            <select id="status" name="status" class="form-control">
                <option value="all" {% if status_filter == 'all' %}selected{% endif %}>All</option>
                <option value="pending" {% if status_filter == 'pending' %}selected{% endif %}>â³ Pending</option>
                <option value="approved" {% if status_filter == 'approved' %}selected{% endif %}>âœ… Approved</option>
                <option value="rejected" {% if status_filter == 'rejected' %}selected{% endif %}>âŒ Rejected</option>
                <option value="completed" {% if status_filter == 'completed' %}selected{% endif %}>ğŸ‰ Completed</option>
            </select>
        </div>
        
        <div class="form-group" style="min-width: 150px; margin-bottom: 0;">
            <label for="date_range">Date Range</label>
            <select id="date_range" name="date_range" class="form-control">
                <option value="7" {% if date_range == '7' %}selected{% endif %}>Last 7 Days</option>
                <option value="30" {% if date_range == '30' %}selected{% endif %}>Last 30 Days</option>
                <option value="90" {% if date_range == '90' %}selected{% endif %}>Last 90 Days</option>
                <option value="all" {% if date_range == 'all' %}selected{% endif %}>All Time</option>
            </select>
        </div>
        
        <button type="submit" class="btn btn-primary">
            ğŸ” Filter
        </button>
        
        {% if search_query or status_filter != 'all' or date_range != '30' %}
        <a href="{{ url_for('returns.index') }}" class="btn btn-secondary">
            Clear
        </a>
        {% endif %}
    </form>
</div>

<!-- Returns List -->
<div class="card">
    {% if returns %}
    <div style="overflow-x: auto;">
        <table class="table">
            <thead>
                <tr>
                    <th>Return #</th>
                    <th>Date</th>
                    <th>Invoice</th>
                    <th>Customer</th>
                    <th>Amount</th>
                    <th>Refund Method</th>
                    <th>Status</th>
                    <th>Actions</th>
                </tr>
            </thead>
            <tbody>
                {% for ret in returns %}
                <tr>
                    <td style="font-weight: 600;">{{ ret.return_number }}</td>
                    <td>{{ ret.return_date.strftime('%d-%b-%Y') }}</td>
                    <td>
                        {% if ret.invoice_id %}
                        <a href="{{ url_for('invoices.view', invoice_id=ret.invoice_id) }}" 
                           style="color: #3498db; text-decoration: none;">
                            {{ ret.invoice_number }}
                        </a>
                        {% else %}
                        {{ ret.invoice_number }}
                        {% endif %}
                    </td>
                    <td>
                        <div style="font-weight: 600;">{{ ret.customer_name }}</div>
                    </td>
                    <td style="font-weight: 600; color: #e74c3c;">-â‚¹{{ "%.2f"|format(ret.total_amount) }}</td>
                    <td>
                        {% if ret.refund_method == 'cash' %}
                        ğŸ’µ Cash
                        {% elif ret.refund_method == 'bank' %}
                        ğŸ¦ Bank
                        {% elif ret.refund_method == 'credit_note' %}
                        ğŸ“ Credit Note
                        {% elif ret.refund_method == 'exchange' %}
                        ğŸ”„ Exchange
                        {% else %}
                        â³ Pending
                        {% endif %}
                    </td>
                    <td>
                        {% if ret.status == 'pending' %}
                        <span class="badge" style="background: #f39c12;">â³ Pending</span>
                        {% elif ret.status == 'approved' %}
                        <span class="badge" style="background: #2ecc71;">âœ… Approved</span>
                        {% elif ret.status == 'rejected' %}
                        <span class="badge" style="background: #e74c3c;">âŒ Rejected</span>
                        {% elif ret.status == 'completed' %}
                        <span class="badge" style="background: #27ae60;">ğŸ‰ Completed</span>
                        {% endif %}
                        {% if ret.credit_note_number %}
                        <div style="font-size: 11px; color: #666; margin-top: 4px;">
                            {{ ret.credit_note_number }}
                        </div>
                        {% endif %}
                    </td>
                    <td>
                        <a href="{{ url_for('returns.view', return_id=ret.id) }}" 
                           class="btn btn-sm btn-primary" style="padding: 4px 12px; font-size: 13px;">
                            ğŸ‘ï¸ View
                        </a>
                    </td>
                </tr>
                {% endfor %}
            </tbody>
        </table>
    </div>
    
    <!-- Pagination -->
    {% if pagination.pages > 1 %}
    <div style="display: flex; justify-content: center; margin-top: 20px; gap: 5px;">
        {% if pagination.has_prev %}
        <a href="{{ url_for('returns.index', page=pagination.prev_num, status=status_filter, date_range=date_range, search=search_query) }}" 
           class="btn btn-secondary">â† Previous</a>
        {% endif %}
        
        <span style="padding: 8px 16px; background: #ecf0f1; border-radius: 5px;">
            Page {{ pagination.page }} of {{ pagination.pages }}
        </span>
        
        {% if pagination.has_next %}
        <a href="{{ url_for('returns.index', page=pagination.next_num, status=status_filter, date_range=date_range, search=search_query) }}" 
           class="btn btn-secondary">Next â†’</a>
        {% endif %}
    </div>
    {% endif %}
    
    {% else %}
    
    <!-- Empty State -->
    <div style="text-align: center; padding: 60px 20px;">
        <div style="font-size: 64px; margin-bottom: 20px;">ğŸ“¦</div>
        <h3 style="color: #7f8c8d; margin-bottom: 10px;">No Returns Found</h3>
        <p style="color: #95a5a6; margin-bottom: 25px;">
            {% if search_query or status_filter != 'all' %}
            No returns match your filters. Try adjusting your search criteria.
            {% else %}
            You haven't processed any returns yet.
            {% endif %}
        </p>
        <a href="{{ url_for('returns.create') }}" class="btn btn-primary">
            + Create First Return
        </a>
    </div>
    
    {% endif %}
</div>

<style>
.stats-grid {
    display: grid;
    grid-template-columns: repeat(auto-fit, minmax(250px, 1fr));
    gap: 20px;
    margin-bottom: 25px;
}

.stat-card {
    background: white;
    border-radius: 10px;
    padding: 20px;
    display: flex;
    align-items: center;
    gap: 15px;
    box-shadow: 0 2px 4px rgba(0,0,0,0.1);
}

.stat-icon {
    width: 60px;
    height: 60px;
    border-radius: 10px;
    display: flex;
    align-items: center;
    justify-content: center;
    font-size: 28px;
    color: white;
}

.stat-content {
    flex: 1;
}

.stat-value {
    font-size: 24px;
    font-weight: 700;
    color: #2c3e50;
    margin-bottom: 5px;
}

.stat-label {
    font-size: 13px;
    color: #7f8c8d;
    text-transform: uppercase;
    letter-spacing: 0.5px;
}

.badge {
    padding: 5px 12px;
    border-radius: 12px;
    font-size: 12px;
    font-weight: 600;
    color: white;
    white-space: nowrap;
}
</style>

{% endblock %}

