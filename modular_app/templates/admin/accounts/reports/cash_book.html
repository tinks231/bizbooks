{% extends "base_sidebar.html" %}

{% block title %}Cash Book{% endblock %}

{% block page_title %}üìñ Cash Book{% endblock %}

{% block header_actions %}
<button onclick="window.print()" class="btn btn-secondary">
    üñ®Ô∏è Print
</button>
{% endblock %}

{% block content %}

<div class="container-fluid" style="padding: 30px;">
    
    <!-- Date Filter Card -->
    <div style="background: white; border-radius: 12px; padding: 25px; margin-bottom: 25px; box-shadow: 0 2px 8px rgba(0,0,0,0.08);">
        <form method="GET" action="{{ url_for('accounts.cash_book') }}" style="display: flex; gap: 20px; align-items: end; flex-wrap: wrap;">
            <div style="flex: 1; min-width: 200px;">
                <label style="display: block; font-size: 13px; font-weight: 600; color: #666; margin-bottom: 8px;">From Date</label>
                <input type="date" name="start_date" value="{{ start_date.strftime('%Y-%m-%d') }}" 
                       style="width: 100%; padding: 10px; border: 2px solid #e0e0e0; border-radius: 8px; font-size: 14px;">
            </div>
            <div style="flex: 1; min-width: 200px;">
                <label style="display: block; font-size: 13px; font-weight: 600; color: #666; margin-bottom: 8px;">To Date</label>
                <input type="date" name="end_date" value="{{ end_date.strftime('%Y-%m-%d') }}" 
                       style="width: 100%; padding: 10px; border: 2px solid #e0e0e0; border-radius: 8px; font-size: 14px;">
            </div>
            <button type="submit" style="padding: 10px 25px; background: linear-gradient(135deg, #667eea 0%, #764ba2 100%); color: white; border: none; border-radius: 8px; font-weight: 600; cursor: pointer;">
                üîç View Report
            </button>
        </form>
    </div>

    <!-- Report Header -->
    <div style="background: linear-gradient(135deg, #667eea 0%, #764ba2 100%); color: white; border-radius: 12px; padding: 25px; margin-bottom: 25px; box-shadow: 0 4px 15px rgba(102, 126, 234, 0.3);">
        <h2 style="margin: 0 0 10px 0; font-size: 24px;">üìñ Cash Book</h2>
        <div style="font-size: 14px; opacity: 0.9;">
            {{ account_name or 'Cash in Hand' }} | Period: {{ start_date.strftime('%d %b %Y') }} to {{ end_date.strftime('%d %b %Y') }}
        </div>
    </div>

    <!-- Ledger Table (Tally Style) -->
    <div class="tally-ledger" style="background: white; border: 1px solid #ddd; border-radius: 4px; overflow: hidden;">
        <table style="width: 100%; border-collapse: collapse; font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;">
            <thead>
                <tr style="background: #f8f9fa; border-bottom: 2px solid #333;">
                    <th style="padding: 10px; text-align: left; font-weight: 600; font-size: 12px; border-right: 1px solid #ddd; width: 10%;">DATE</th>
                    <th style="padding: 10px; text-align: left; font-weight: 600; font-size: 12px; border-right: 1px solid #ddd; width: 40%;">PARTICULARS</th>
                    <th style="padding: 10px; text-align: center; font-weight: 600; font-size: 12px; border-right: 1px solid #ddd; width: 12%;">VCH TYPE</th>
                    <th style="padding: 10px; text-align: center; font-weight: 600; font-size: 12px; border-right: 1px solid #ddd; width: 13%;">VCH NO.</th>
                    <th style="padding: 10px; text-align: right; font-weight: 600; font-size: 12px; border-right: 1px solid #ddd; width: 12.5%;">RECEIPTS</th>
                    <th style="padding: 10px; text-align: right; font-weight: 600; font-size: 12px; width: 12.5%;">PAYMENTS</th>
                </tr>
            </thead>
            <tbody>
                <!-- Transactions -->
                {% if transactions %}
                    {% for txn in transactions %}
                    <tr style="border-bottom: 1px solid #e9ecef;">
                        <td style="padding: 8px; border-right: 1px solid #ddd; font-size: 13px; color: #333;">
                            {{ txn[0].strftime('%d-%b-%y') }}
                        </td>
                        <td style="padding: 8px; border-right: 1px solid #ddd; font-size: 13px;">
                            <div style="font-weight: 500; color: #333;">{{ txn[5] }}</div>
                            {% if txn[6] %}
                            <div style="font-size: 11px; color: #666; margin-top: 2px;">{{ txn[6] }}</div>
                            {% endif %}
                        </td>
                        <td style="padding: 8px; border-right: 1px solid #ddd; text-align: center; font-size: 12px; color: #666;">
                            {% if txn[1] == 'invoice_payment' %}Sales
                            {% elif txn[1] == 'bill_payment' %}Purchase
                            {% elif txn[1] == 'expense' %}Expense
                            {% elif txn[1] == 'contra_in' %}Contra
                            {% elif txn[1] == 'contra_out' %}Contra
                            {% elif txn[1] == 'employee_advance' %}Payment
                            {% elif txn[1] == 'employee_return' %}Receipt
                            {% else %}{{ txn[1]|title }}{% endif %}
                        </td>
                        <td style="padding: 8px; border-right: 1px solid #ddd; text-align: center; font-size: 12px; color: #666;">
                            {{ txn[5][:20] if txn[5] else '-' }}
                        </td>
                        <td style="padding: 8px; border-right: 1px solid #ddd; text-align: right; font-size: 13px; font-family: 'Courier New', monospace;">
                            {% if txn[2] > 0 %}{{ "{:,.2f}".format(txn[2]) }}{% endif %}
                        </td>
                        <td style="padding: 8px; text-align: right; font-size: 13px; font-family: 'Courier New', monospace;">
                            {% if txn[3] > 0 %}{{ "{:,.2f}".format(txn[3]) }}{% endif %}
                        </td>
                    </tr>
                    {% endfor %}
                {% else %}
                    <tr>
                        <td colspan="6" style="padding: 40px; text-align: center; color: #999;">
                            No transactions found for this period
                        </td>
                    </tr>
                {% endif %}
                
                <!-- Opening Balance -->
                <tr style="background: #fffbf0; border-top: 2px solid #333;">
                    <td style="padding: 8px; border-right: 1px solid #ddd; font-size: 13px;"></td>
                    <td style="padding: 8px; border-right: 1px solid #ddd; font-size: 13px; font-weight: 600; color: #000;">Opening Balance</td>
                    <td style="padding: 8px; border-right: 1px solid #ddd;"></td>
                    <td style="padding: 8px; border-right: 1px solid #ddd;"></td>
                    <td style="padding: 8px; border-right: 1px solid #ddd; text-align: right; font-size: 13px; font-weight: 600; font-family: 'Courier New', monospace;">{{ "{:,.2f}".format(opening_balance) }}</td>
                    <td style="padding: 8px; text-align: right; font-size: 13px;"></td>
                </tr>
                
                <!-- Current Totals -->
                <tr style="background: #f8f9fa; border-bottom: 2px solid #333;">
                    <td style="padding: 10px; border-right: 1px solid #ddd; font-size: 13px;"></td>
                    <td style="padding: 10px; border-right: 1px solid #ddd; font-size: 13px; font-weight: 700; color: #000;">Current Totals</td>
                    <td style="padding: 10px; border-right: 1px solid #ddd;"></td>
                    <td style="padding: 10px; border-right: 1px solid #ddd;"></td>
                    <td style="padding: 10px; border-right: 1px solid #ddd; text-align: right; font-size: 14px; font-weight: 700; font-family: 'Courier New', monospace; color: #000;">{{ "{:,.2f}".format(total_receipts) }}</td>
                    <td style="padding: 10px; text-align: right; font-size: 14px; font-weight: 700; font-family: 'Courier New', monospace; color: #000;">{{ "{:,.2f}".format(total_payments) }}</td>
                </tr>
                
                <!-- Closing Balance -->
                <tr style="background: #fffbf0; font-weight: 700;">
                    <td style="padding: 10px; border-right: 1px solid #ddd; font-size: 13px;"></td>
                    <td style="padding: 10px; border-right: 1px solid #ddd; font-size: 13px; font-weight: 700; color: #000;">Closing Balance</td>
                    <td style="padding: 10px; border-right: 1px solid #ddd;"></td>
                    <td style="padding: 10px; border-right: 1px solid #ddd;"></td>
                    <td style="padding: 10px; border-right: 1px solid #ddd; text-align: right; font-size: 14px; font-weight: 700; font-family: 'Courier New', monospace; color: #000;">
                        {{ "{:,.2f}".format(closing_balance) }}
                    </td>
                    <td style="padding: 10px; text-align: right; font-size: 14px; font-weight: 700; font-family: 'Courier New', monospace; color: #000;">
                    </td>
                </tr>
            </tbody>
        </table>
    </div>
</div>

<style>
/* Tally-Style Ledger Formatting */
.tally-ledger table tbody tr:hover {
    background: #f0f8ff !important;
}

.tally-ledger table tbody tr {
    transition: background 0.2s ease;
}

@media print {
    .sidebar, .btn, .nav-header, button, form {
        display: none !important;
    }
    
    body {
        background: white !important;
    }
    
    .container-fluid {
        padding: 20px !important;
    }
    
    .tally-ledger {
        border: 2px solid #000 !important;
    }
    
    .tally-ledger table {
        border-collapse: collapse !important;
    }
    
    .tally-ledger td, .tally-ledger th {
        border: 1px solid #000 !important;
    }
}
</style>

{% endblock %}

