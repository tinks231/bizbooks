{% extends "base_sidebar.html" %}

{% block title %}Edit Item - {{ item.name }} - BizBooks{% endblock %}

{% block page_title %}Edit Item{% endblock %}

{% block header_actions %}
<a href="{{ url_for('items.index') }}" class="btn btn-secondary">
    ‚Üê Back to Items
</a>
{% endblock %}

{% block content %}
<form method="POST" id="itemForm" onsubmit="return validateForm('itemForm')">
    <div class="card">
        <div style="background: #f8f9fa; padding: 15px; border-radius: 6px; margin-bottom: 20px;">
            <strong>SKU:</strong> {{ item.sku }}
            <span class="text-muted" style="margin-left: 20px;">Created: {{ item.created_at.strftime('%d %b %Y') }}</span>
        </div>

        <!-- Type Selection -->
        <div class="form-group">
            <label class="field-label field-label--required">Type</label>
            <div class="radio-group">
                <label>
                    <input type="radio" name="type" value="goods" {% if item.type == 'goods' %}checked{% endif %} required>
                    <span>Goods</span>
                </label>
                <label>
                    <input type="radio" name="type" value="service" {% if item.type == 'service' %}checked{% endif %} required>
                    <span>Service</span>
                </label>
            </div>
        </div>

        <!-- Basic Information -->
        <div class="form-row">
            <div class="form-group">
                <label class="field-label field-label--required">Item Name</label>
                <input type="text" name="name" required value="{{ item.name }}">
            </div>
            
            <div class="form-group">
                <label class="field-label field-label--required">Unit</label>
                <select name="unit" required>
                    <option value="nos" {% if item.unit == 'nos' %}selected{% endif %}>Pieces (nos)</option>
                    <option value="kg" {% if item.unit == 'kg' %}selected{% endif %}>Kilogram (kg)</option>
                    <option value="qtl" {% if item.unit == 'qtl' %}selected{% endif %}>Quintal (qtl)</option>
                    <option value="g" {% if item.unit == 'g' %}selected{% endif %}>Gram (g)</option>
                    <option value="ltr" {% if item.unit == 'ltr' %}selected{% endif %}>Liter (ltr)</option>
                    <option value="ml" {% if item.unit == 'ml' %}selected{% endif %}>Milliliter (ml)</option>
                    <option value="mtr" {% if item.unit == 'mtr' %}selected{% endif %}>Meter (mtr)</option>
                    <option value="cm" {% if item.unit == 'cm' %}selected{% endif %}>Centimeter (cm)</option>
                    <option value="box" {% if item.unit == 'box' %}selected{% endif %}>Box</option>
                    <option value="bag" {% if item.unit == 'bag' %}selected{% endif %}>Bag</option>
                    <option value="packet" {% if item.unit == 'packet' %}selected{% endif %}>Packet</option>
                    <option value="bundle" {% if item.unit == 'bundle' %}selected{% endif %}>Bundle</option>
                    <option value="dozen" {% if item.unit == 'dozen' %}selected{% endif %}>Dozen</option>
                </select>
            </div>
        </div>

        <div class="form-row">
            <div class="form-group">
                <label class="field-label">Category</label>
                <select name="category_id">
                    <option value="">Select Category</option>
                    {% for category in categories %}
                    <option value="{{ category.id }}" {% if item.category_id == category.id %}selected{% endif %}>
                        {{ category.name }}
                    </option>
                    {% endfor %}
                </select>
            </div>

            <div class="form-group">
                <label class="field-label">Item Group</label>
                <select name="item_group_id">
                    <option value="">Select Group</option>
                    {% for group in groups %}
                    <option value="{{ group.id }}" {% if item.item_group_id == group.id %}selected{% endif %}>
                        {{ group.name }}
                    </option>
                    {% endfor %}
                </select>
            </div>
        </div>

        <div class="form-row">
            <div class="form-group">
                <label class="field-label">HSN/SAC Code (for GST)</label>
                <input type="text" name="hsn_code" placeholder="e.g., 8414, 8544" maxlength="20" value="{{ item.hsn_code or '' }}">
                <small class="help-text">Optional - Used in GST reports and invoices</small>
            </div>
            <div class="form-group">
                <!-- Empty placeholder for alignment -->
            </div>
        </div>

        <div class="form-group">
            <label class="checkbox-group">
                <input type="checkbox" name="is_returnable" {% if item.is_returnable %}checked{% endif %}>
                <span>Returnable Item</span>
            </label>
        </div>

        <div class="form-group">
            <label class="checkbox-group">
                <input type="checkbox" name="is_active" {% if item.is_active %}checked{% endif %}>
                <span>Active</span>
            </label>
        </div>

        <!-- Sales & Purchase Information (Simplified for Edit) -->
        <h3 class="section-title">
            üí∞ Pricing
        </h3>

        <div class="form-row">
            <div class="form-group">
                <label class="field-label field-label--required">Selling Price (‚Çπ)</label>
                <input type="number" name="selling_price" step="0.01" min="0" required value="{{ item.selling_price }}">
            </div>
            <div class="form-group">
                <label class="field-label field-label--required">GST Rate</label>
                <select name="gst_rate" required>
                    <option value="0" {% if item.gst_rate == 0 %}selected{% endif %}>0% - Exempted</option>
                    <option value="5" {% if item.gst_rate == 5 %}selected{% endif %}>5% GST</option>
                    <option value="12" {% if item.gst_rate == 12 %}selected{% endif %}>12% GST</option>
                    <option value="18" {% if item.gst_rate == 18 or item.gst_rate is none %}selected{% endif %}>18% GST (Default)</option>
                    <option value="28" {% if item.gst_rate == 28 %}selected{% endif %}>28% GST</option>
                </select>
                <small class="help-text">Default GST rate for this item</small>
            </div>
            <div class="form-group">
                <label class="field-label field-label--required">Cost Price (‚Çπ)</label>
                <input type="number" name="cost_price" step="0.01" min="0" required value="{{ item.cost_price }}">
            </div>
        </div>

        <!-- Inventory Tracking -->
        <h3 class="section-title">
            üìä Inventory Settings
        </h3>

        <div class="form-group">
            <label class="checkbox-group" style="font-weight: 700; font-size: 15px;">
                <input type="checkbox" name="track_inventory" id="trackInventory" {% if item.track_inventory %}checked{% endif %}>
                <span>‚úì Track Inventory for this item</span>
            </label>
        </div>

        <div class="form-row">
            <div class="form-group">
                <label class="field-label">Reorder Point</label>
                <input type="number" name="reorder_point" step="0.01" min="0" value="{{ item.reorder_point }}">
                <small class="help-text">Alert when stock falls below this level</small>
            </div>
            <div class="form-group">
                <!-- Empty placeholder for alignment -->
            </div>
        </div>

        <!-- Form Actions -->
        <div class="form-actions" style="margin-bottom: 100px;">
            <a href="{{ url_for('items.index') }}" class="btn btn-secondary">
                Cancel
            </a>
            <button type="submit" class="btn btn-primary" style="padding: 12px 30px;">
                üíæ Update Item
            </button>
        </div>
    </div>
</form>
{% endblock %}
