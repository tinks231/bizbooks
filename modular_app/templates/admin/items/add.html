{% extends "base_sidebar.html" %}

{% block title %}Add New Item - BizBooks{% endblock %}

{% block page_title %}Add New Item{% endblock %}

{% block header_actions %}
<a href="{{ url_for('items.index') }}" class="btn btn-secondary">
    ‚Üê Back to Items
</a>
{% endblock %}

{% block content %}
<form method="POST" id="itemForm" onsubmit="return validateForm('itemForm')">
    <div class="card">
        <!-- Type Selection -->
        <div class="form-group">
            <label>Type *</label>
            <div style="display: flex; gap: 20px;">
                <label style="display: flex; align-items: center; gap: 8px; cursor: pointer;">
                    <input type="radio" name="type" value="goods" checked required>
                    <span>Goods</span>
                </label>
                <label style="display: flex; align-items: center; gap: 8px; cursor: pointer;">
                    <input type="radio" name="type" value="service" required>
                    <span>Service</span>
                </label>
            </div>
        </div>

        <!-- Basic Information -->
        <div class="form-row">
            <div class="form-group">
                <label>Item Name *</label>
                <input type="text" name="name" required placeholder="e.g., Wire - 2.5mm Copper Cable">
            </div>
            
            <div class="form-group">
                <label style="display: flex; align-items: center; gap: 10px;">
                    SKU
                    <label style="display: inline-flex; align-items: center; gap: 6px; cursor: pointer; font-weight: normal; font-size: 13px;">
                        <input type="checkbox" id="autoSkuCheckbox" checked onchange="toggleSKUMode()">
                        <span>Auto-generate</span>
                    </label>
                </label>
                <input type="text" id="skuInput" name="sku" placeholder="Enter SKU manually" disabled style="background: #f5f7fa; color: #7f8c8d;">
                <small id="skuHint" style="color: #7f8c8d;">SKU will be automatically generated</small>
            </div>
        </div>

        <div class="form-row">
            <div class="form-group">
                <label>Unit *</label>
                <select name="unit" required>
                    <option value="nos">Pieces (nos)</option>
                    <option value="kg">Kilogram (kg)</option>
                    <option value="g">Gram (g)</option>
                    <option value="ltr">Liter (ltr)</option>
                    <option value="ml">Milliliter (ml)</option>
                    <option value="mtr">Meter (mtr)</option>
                    <option value="cm">Centimeter (cm)</option>
                    <option value="box">Box</option>
                    <option value="bag">Bag</option>
                    <option value="packet">Packet</option>
                    <option value="bundle">Bundle</option>
                    <option value="dozen">Dozen</option>
                </select>
            </div>

            <div class="form-group" style="display: flex; align-items: center; justify-content: flex-start; padding-top: 28px;">
                <label style="display: inline-flex; align-items: center; gap: 8px; cursor: pointer; margin: 0;">
                    <input type="checkbox" name="is_returnable" checked>
                    <span>Returnable Item</span>
                </label>
            </div>
        </div>

        <!-- Classification -->
        <div class="form-row">
            <div class="form-group">
                <label>Category</label>
                <select name="category_id">
                    <option value="">Select Category</option>
                    {% for category in categories %}
                    <option value="{{ category.id }}">{{ category.name }}</option>
                    {% endfor %}
                </select>
                <small style="color: #7f8c8d;">
                    Don't see your category? <a href="{{ url_for('items.categories') }}" target="_blank">Add Category</a>
                </small>
            </div>

            <div class="form-group">
                <label>Item Group</label>
                <select name="item_group_id">
                    <option value="">Select Group</option>
                    {% for group in groups %}
                    <option value="{{ group.id }}">{{ group.name }}</option>
                    {% endfor %}
                </select>
                <small style="color: #7f8c8d;">
                    Don't see your group? <a href="{{ url_for('items.groups') }}" target="_blank">Add Group</a>
                </small>
            </div>
        </div>

        <!-- Dimensions & Weight -->
        <h3 style="margin: 30px 0 15px; color: #2c3e50; font-size: 16px; border-top: 2px solid #f5f7fa; padding-top: 20px;">
            üìê Dimensions & Weight (Optional)
        </h3>

        <div class="form-row">
            <div class="form-group">
                <label>Length</label>
                <input type="number" name="dimensions_length" step="0.01" min="0" placeholder="0.00">
            </div>
            <div class="form-group">
                <label>Width</label>
                <input type="number" name="dimensions_width" step="0.01" min="0" placeholder="0.00">
            </div>
            <div class="form-group">
                <label>Height</label>
                <input type="number" name="dimensions_height" step="0.01" min="0" placeholder="0.00">
            </div>
            <div class="form-group">
                <label>Unit</label>
                <select name="dimensions_unit">
                    <option value="cm">Centimeter (cm)</option>
                    <option value="m">Meter (m)</option>
                    <option value="inch">Inch</option>
                    <option value="ft">Feet</option>
                </select>
            </div>
        </div>

        <div class="form-row">
            <div class="form-group">
                <label>Weight</label>
                <input type="number" name="weight" step="0.01" min="0" placeholder="0.00">
            </div>
            <div class="form-group">
                <label>Weight Unit</label>
                <select name="weight_unit">
                    <option value="kg">Kilogram (kg)</option>
                    <option value="g">Gram (g)</option>
                    <option value="lb">Pound (lb)</option>
                </select>
            </div>
        </div>

        <!-- Product Identifiers -->
        <h3 style="margin: 30px 0 15px; color: #2c3e50; font-size: 16px; border-top: 2px solid #f5f7fa; padding-top: 20px;">
            üè∑Ô∏è Product Identifiers (Optional)
        </h3>

        <div class="form-row">
            <div class="form-group">
                <label>Manufacturer</label>
                <input type="text" name="manufacturer" placeholder="e.g., Anchor">
            </div>
            <div class="form-group">
                <label>Brand</label>
                <input type="text" name="brand" placeholder="e.g., Anchor">
            </div>
        </div>

        <div class="form-row">
            <div class="form-group">
                <label>UPC</label>
                <input type="text" name="upc" placeholder="Universal Product Code">
            </div>
            <div class="form-group">
                <label>EAN</label>
                <input type="text" name="ean" placeholder="European Article Number">
            </div>
            <div class="form-group">
                <label>MPN</label>
                <input type="text" name="mpn" placeholder="Manufacturer Part Number">
            </div>
        </div>

        <!-- Sales Information -->
        <h3 style="margin: 30px 0 15px; color: #2c3e50; font-size: 16px; border-top: 2px solid #f5f7fa; padding-top: 20px;">
            üí∞ Sales Information
        </h3>

        <div class="form-row">
            <div class="form-group">
                <label>Selling Price (‚Çπ) *</label>
                <input type="number" name="selling_price" step="0.01" min="0" required placeholder="0.00">
            </div>
            <div class="form-group">
                <label>Account</label>
                <select name="sales_account">
                    <option value="Sales">Sales</option>
                    <option value="Revenue">Revenue</option>
                    <option value="Income">Income</option>
                </select>
            </div>
        </div>

        <div class="form-group">
            <label>Sales Description</label>
            <textarea name="sales_description" rows="3" placeholder="Description shown on invoices..."></textarea>
        </div>

        <!-- Purchase Information -->
        <h3 style="margin: 30px 0 15px; color: #2c3e50; font-size: 16px; border-top: 2px solid #f5f7fa; padding-top: 20px;">
            üõí Purchase Information
        </h3>

        <div class="form-row">
            <div class="form-group">
                <label>Cost Price (‚Çπ) *</label>
                <input type="number" name="cost_price" step="0.01" min="0" required placeholder="0.00">
            </div>
            <div class="form-group">
                <label>Account</label>
                <select name="purchase_account">
                    <option value="Cost of Goods Sold">Cost of Goods Sold</option>
                    <option value="Purchases">Purchases</option>
                    <option value="Inventory">Inventory</option>
                </select>
            </div>
        </div>

        <div class="form-row">
            <div class="form-group">
                <label>Preferred Vendor</label>
                <input type="text" name="preferred_vendor" placeholder="Vendor name">
            </div>
        </div>

        <div class="form-group">
            <label>Purchase Description</label>
            <textarea name="purchase_description" rows="3" placeholder="Description for purchase orders..."></textarea>
        </div>

        <!-- Inventory Tracking -->
        <h3 style="margin: 30px 0 15px; color: #2c3e50; font-size: 16px; border-top: 2px solid #f5f7fa; padding-top: 20px;">
            üìä Inventory Tracking
        </h3>

        <div class="form-group">
            <label style="display: flex; align-items: center; gap: 8px; cursor: pointer; font-weight: 700; font-size: 15px;">
                <input type="checkbox" name="track_inventory" id="trackInventory" checked onchange="toggleInventoryFields()">
                <span>‚úì Track Inventory for this item</span>
            </label>
            <small style="color: #7f8c8d;">Enable this to track stock levels across sites</small>
        </div>

        <div id="inventoryFields">
            <div class="form-row">
                <div class="form-group">
                    <label>Opening Stock</label>
                    <input type="number" name="opening_stock" step="0.01" min="0" placeholder="0.00">
                    <small style="color: #7f8c8d;">Initial stock quantity</small>
                </div>
                <div class="form-group">
                    <label>Opening Stock Value (‚Çπ)</label>
                    <input type="number" name="opening_stock_value" step="0.01" min="0" placeholder="0.00">
                    <small style="color: #7f8c8d;">Total value of opening stock</small>
                </div>
            </div>

            <div class="form-row">
                <div class="form-group">
                    <label>Reorder Point</label>
                    <input type="number" name="reorder_point" step="0.01" min="0" placeholder="0.00">
                    <small style="color: #7f8c8d;">Alert when stock falls below this level</small>
                </div>
            </div>
        </div>

        <!-- Form Actions -->
        <div style="margin-top: 40px; display: flex; gap: 15px; justify-content: flex-end; border-top: 2px solid #f5f7fa; padding-top: 20px;">
            <a href="{{ url_for('items.index') }}" class="btn btn-secondary">
                Cancel
            </a>
            <button type="submit" class="btn btn-primary" style="padding: 12px 30px;">
                üíæ Save Item
            </button>
        </div>
    </div>
</form>

<script>
    function toggleSKUMode() {
        const autoSkuCheckbox = document.getElementById('autoSkuCheckbox');
        const skuInput = document.getElementById('skuInput');
        const skuHint = document.getElementById('skuHint');
        
        if (autoSkuCheckbox.checked) {
            // Auto-generate mode
            skuInput.disabled = true;
            skuInput.value = '';
            skuInput.placeholder = 'Auto-generated';
            skuInput.style.background = '#f5f7fa';
            skuInput.style.color = '#7f8c8d';
            skuHint.textContent = 'SKU will be automatically generated';
        } else {
            // Manual mode
            skuInput.disabled = false;
            skuInput.placeholder = 'Enter SKU (e.g., PE-FS-W-40)';
            skuInput.style.background = 'white';
            skuInput.style.color = '#2c3e50';
            skuInput.focus();
            skuHint.textContent = 'Enter your custom SKU code';
        }
    }
    
    function toggleInventoryFields() {
        const trackInventory = document.getElementById('trackInventory');
        const inventoryFields = document.getElementById('inventoryFields');
        
        if (trackInventory.checked) {
            inventoryFields.style.display = 'block';
        } else {
            inventoryFields.style.display = 'none';
        }
    }
    
    // Initialize on page load
    toggleInventoryFields();
</script>
{% endblock %}

